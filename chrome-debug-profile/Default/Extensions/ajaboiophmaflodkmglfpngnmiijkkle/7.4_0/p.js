document['querySelectorAll']('[data-locale]')['forEach'](a1=>{a1['innerText']=chrome['i18n']['getMessage'](a1['dataset']['locale']);});let a='update',b='downward',c=1;const d=5;let e,f,g,h,i;const j=document['getElementById']('loaderContainer'),k=document['getElementById']('pages-nav-info'),l=document['getElementById']('content'),m=document['getElementById']('empty'),n=document['getElementById']('table'),o=document['getElementById']('pages-nav'),p=document['getElementById']('pages-prev'),q=document['getElementById']('pages-next'),r=document['getElementById']('pages-rows'),s=document['getElementById']('sort-updated'),t=document['getElementById']('sort-updated-icon'),u=document['getElementById']('sort-num'),v=document['getElementById']('sort-num-icon'),w=document['getElementById']('backdrop'),x=document['getElementById']('modal-delete'),y=document['getElementById']('modal-url'),z=document['getElementById']('delete-cancel-btn'),A=document['getElementById']('url-cancel-btn'),B=document['getElementById']('delete-confirm-btn'),C=document['getElementById']('url-confirm-btn'),D=document['getElementById']('search-input'),E=document['getElementById']('current-url'),F=document['getElementById']('new-url');F['placeholder']=chrome['i18n']['getMessage']('url_placeholder');const G=document['getElementById']('url-error');let H,I='dark',J=null,K=null,L=![];document['getElementById']('fetch-pages')['onclick']=async()=>{if(!K||L){P(chrome['i18n']['getMessage']('login_to_sync'),'err');return;}j['style']['display']='flex';try{const a1=await new Promise((a2,a3)=>{chrome['runtime']['sendMessage']({'type':'rp','payload':{'urls':g['map'](a4=>a4['url']),'zM02_ath':K}},a2);});j['style']['display']='none';if(a1['message']!=='success'){P(chrome['i18n']['getMessage']('error'),'err');return;}await Promise['all'](a1['pages']['map'](async a2=>{const a3={[a2['url']]:{'highlights':[]}};await new Promise((a4,a5)=>{chrome['storage']['local']['set'](a3,()=>{chrome['runtime']['lastError']?a5(chrome['runtime']['lastError']):(g['push']({'url':a2['url'],'str':a2['url'],'updatedAt':null,'updatedAtStr':U(null),'syncedAtStr':U(null),'highlightsNum':0,'syncedOn':null}),a4());});});})),M();if(a1['pages']['length']===0)P(chrome['i18n']['getMessage']('success_fetch_pages_zero'));else P(chrome['i18n']['getMessage']('success_fetch_pages',a1['pages']['length']['toString']()));}catch(a2){P(chrome['i18n']['getMessage']('error'));}},document['getElementById']('theme')['onclick']=()=>{I=I==='dark'?'light':'dark',document['body']['className']='pages-'+I,document['getElementById']('theme-icon')['src']=I==='dark'?chrome['runtime']['getURL']('icons/light-mode.svg'):chrome['runtime']['getURL']('icons/dark-mode.svg');};const M=()=>{const a1=D['value']['toLowerCase']();if(a1==='')i=[...g];else{const a2=a1['split'](' ')['filter'](a3=>a3['trim']()!=='');i=g['filter'](a3=>{return a2['some'](a4=>a3['str']['toLowerCase']()['includes'](a4));});}c=1,a0();};D['addEventListener']('input',M),F['addEventListener']('keydown',()=>{G['style']['display']='none';});const N=a1=>{w['style']['display']='flex',x['style']['display']='block',w['onclick']=()=>{x['style']['display']='none',w['style']['display']='none';},z['onclick']=()=>w['click'](),B['onclick']=()=>{w['click'](),j['style']['display']='flex',chrome['runtime']['sendMessage']({'type':'dp','payload':{'url':a1['url']}},a2=>{j['style']['display']='none';if(chrome['runtime']['lastError']||a2['message']=='Error'){P(chrome['i18n']['getMessage']('error'),'err');return;}i=i['filter'](a3=>a3!==a1),g=g['filter'](a3=>a3!==a1),a0();});};},O=a1=>{w['style']['display']='flex',w['onclick']=()=>{G['style']['display']='none',F['value']='',y['style']['display']='none',w['style']['display']='none';},y['style']['display']='block',F['focus'](),E['value']=a1['url'],A['onclick']=()=>w['click'](),C['onclick']=async()=>{let a2;try{a2=new URL(F['value']);if(a2['protocol']==='file:'&&!a2['pathname']['toLowerCase']()['endsWith']('.pdf'))throw new Error();}catch(a3){G['style']['display']='block';return;}if(a2['protocol']==='file:')a2=a2['pathname']['slice'](1);else a2=a2['hostname']+a2['pathname']+a2['search'];try{w['click']();if(a2===a1['url'])return;j['style']['display']='flex',chrome['runtime']['sendMessage']({'type':'ch-u','payload':{'zM02_ath':K,'url':a1['url'],'new':a2,'data':h[a1['url']]}},a4=>{j['style']['display']='none';if(a4['message']!=='success')throw new Error('error');a1['url']=a2;});}catch(a4){P(chrome['i18n']['getMessage']('error'),'err');}};},P=(a1,a2='reg')=>{if(H)H['remove']();H=document['createElement']('div'),H['className']='notificationContainer',H['style']['backgroundColor']=a2==='err'?'#FF4444':'#000';const a3=document['createElement']('div');a3['className']='notificationTxt',a3['innerHTML']=a1,H['appendChild'](a3),document['body']['appendChild'](H),setTimeout(()=>{H['style']['opacity']='0',H['style']['transition']='opacity 0.5s ease-out',H['classList']['add']('fadeOut'),setTimeout(()=>{H['remove']();},500);},3000);};async function Q(a1=null,a2){return new Promise(a3=>{a2?chrome['storage']['local']['get']({[a1]:a2},a4=>{a3(a4[a1]);}):chrome['storage']['local']['get'](a1,a4=>{a3(a4[a1]);});});}async function R(){J=await Q('auth'),K=null,L=![],J&&(K=J['token'],L=J['deactivated']?!![]:![]);}const S=(a1,a2='check',a3)=>{a1['style']['display']='none';const a4=document['createElement']('img');a4['width']='20',a4['height']='20',a4['src']=chrome['runtime']['getURL']('icons/'+a2+'.svg');if(a3)a4['className']=a3;a1['parentNode']['insertBefore'](a4,a1),setTimeout(()=>{a4['remove'](),a1['style']['display']='';},2000);};document['title']=chrome['i18n']['getMessage']('pages');async function T(){return new Promise(a1=>{chrome['storage']['local']['get'](null,a2=>{a1(a2);});});}const U=a1=>{if(!(a1 instanceof Date)||isNaN(a1))return'---';return a1['toLocaleDateString']();},V=a1=>{if(a==='update')a1['sort']((a2,a3)=>{if(b=='downward')return a3['updatedAt']-a2['updatedAt'];else return a2['updatedAt']-a3['updatedAt'];});else a==='num'&&a1['sort']((a2,a3)=>{if(b=='downward')return a3['highlightsNum']-a2['highlightsNum'];else return a2['highlightsNum']-a3['highlightsNum'];});return a1;};s['onclick']=()=>{t['style']['opacity']='1',v['style']['opacity']='0',c=1,a==='update'?b=b==='downward'?'upward':'downward':(a='update',b='downward'),t['src']=chrome['runtime']['getURL']('icons/arrow-'+b+'.svg'),i=V(i),a0();},u['onclick']=()=>{v['style']['opacity']='1',t['style']['opacity']='0',c=1,a==='num'?b=b==='downward'?'upward':'downward':(a='num',b='downward'),v['src']=chrome['runtime']['getURL']('icons/arrow-'+b+'.svg'),i=V(i),a0();};const W=a1=>{g=[];for(const a2 in a1){if(a2!=='auto'&&a2!=='u'&&a2!=='i'&&a2!=='undefined'&&a2!=='pdfData'&&a2!=='auth'&&a2!=='cursorColor'&&a2!=='smodal'&&a2!=='toolbar'&&a2!=='theme'&&a2!=='ff'){let {highlights:a3,syncedOn:a4,title:a5,updatedAt:a6,note:a7,_id:a8}=a1[a2];if(!a3)break;a3=a3['filter'](ae=>{return!ae['status']||!ae['status']['includes']('deleted');});if(a3['length']===0){g['push']({'url':a2,'title':a5,'note':a7,'_id':a8,'str':a5?a5+' '+a2:a2,'updatedAt':a6,'updatedAtStr':U(a6?new Date(a6):null),'syncedOn':a4,'syncedAtStr':U(a4?new Date(a4):null),'highlightsNum':0});continue;}const a9=a3['length'],aa=a3[a9-1];!a6&&(a6=aa['updatedAt']?new Date(aa['updatedAt']):new Date(aa['createdAt']));const ab=U(a6?new Date(a6):null),ac=U(a4?new Date(a4):null),ad=a3['map'](ae=>{let af=a5?a5+' '+a2:a2;if(a7&&a7!=='')af+=' '+a7;let ag=af+' '+ae['text'];if(ae['comment'])ag+=' '+ae['comment'];return ag;})['join'](' ');g['push']({'url':a2,'title':a5,'note':a7,'_id':a8,'str':ad,'updatedAt':a6,'updatedAtStr':ab,'syncedAtStr':ac,'highlightsNum':a9,'syncedOn':new Date(a4)});}}g=V(g),i=[...g];},X=()=>{e=(c-1)*d+1,f=e+(d-1);if(f>pagesNumResult)f=pagesNumResult;return e+'-'+f+' of '+pagesNumResult;},Y=a1=>{a1['style']['cursor']='default',a1['style']['opacity']='0.3';},Z=a1=>{a1['style']['cursor']='pointer',a1['style']['opacity']='1';},a0=()=>{pagesNumResult=i['length'];if(pagesNumResult===0){m['style']['display']='block',n['style']['display']='none',o['style']['display']='none';return;}m['style']['display']='none',n['style']['display']='flex',o['style']['display']='flex',k['innerText']=X();if(c===1)Y(p);else Z(p);if(f===pagesNumResult)Y(q);else Z(q);const a1=(c-1)*d,a2=a1+d,a3=i['slice'](a1,a2);r['innerHTML']='',a3['forEach'](a4=>{const a5=document['createElement']('div');a5['className']='pages-list-row-page',a5['id']=a4['url'];const a6=document['createElement']('div');a6['className']='cell-page linkBtn',a6['innerText']=a4['title']?a4['title']:a4['url'];const a7=document['createElement']('div');a7['className']='cell updated';const a8=document['createElement']('span');a8['style']['paddingLeft']='14px',a8['innerText']=a4['updatedAtStr'],a7['appendChild'](a8);const a9=document['createElement']('div');a9['className']='cell synced';const aa=document['createElement']('span');aa['id']=a4['url']+'-syncedOn',aa['innerText']=a4['syncedAtStr'],a9['appendChild'](aa);const ab=document['createElement']('div');ab['className']='cell highlights';const ac=document['createElement']('span');ac['id']=a4['url']+'-num',ac['style']['paddingLeft']='14px';const ad=document['createElement']('div');ad['className']='cell-actions';const ae=document['createElement']('div');ae['className']='imgBtn';const af=document['createElement']('div');af['className']='tooltip',af['innerText']=chrome['i18n']['getMessage']('btn_url'),ae['appendChild'](af);const ag=document['createElement']('img');ag['src']=chrome['runtime']['getURL']('icons/link.svg'),ag['className']='img-filter',ag['width']='20',ag['height']='20',ae['appendChild'](ag),ae['onclick']=()=>{O(a4);},ad['appendChild'](ae);const ah=document['createElement']('div');ah['className']='imgBtn';const ai=document['createElement']('div');ai['className']='tooltip',ai['innerText']=chrome['i18n']['getMessage']('delete'),ah['appendChild'](ai);const aj=document['createElement']('img');aj['src']=chrome['runtime']['getURL']('icons/delete.svg'),aj['className']='img-filter',aj['width']='20',aj['height']='20',ah['appendChild'](aj),ah['onclick']=()=>{N(a4);},ad['appendChild'](ah),ac['innerText']=a4['highlightsNum'],ab['appendChild'](ac),a5['appendChild'](a6),a5['appendChild'](a7),a5['appendChild'](a9),a5['appendChild'](ab),a5['appendChild'](ad),a6['onclick']=()=>{chrome['runtime']['sendMessage']({'type':'ou','payload':{'url':a4['url'][1]===':'?a4['url']:'http:\x5c'+a4['url']}});},a7['onclick']=()=>a6['click'](),a9['onclick']=()=>a6['click'](),ab['onclick']=()=>a6['click'](),r['appendChild'](a5);});};p['onclick']=()=>{if(c===1)return;c--,a0();},q['onclick']=()=>{if(c*d>=i['length'])return;c++,a0();},((async()=>{D['placeholder']=chrome['i18n']['getMessage']('search_placeholder'),await R(),j['style']['display']='flex',chrome['storage']['local']['remove']('pdfData'),h=await T(),W(h),l['style']['display']='block',a0(),j['style']['display']='none';})());