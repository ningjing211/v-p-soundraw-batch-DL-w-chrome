const c='https://zetamarker-api.herokuapp.com',d='https://www.zetamarker.com',e='https://app.zetamarker.com';chrome['runtime']['onMessageExternal']['addListener']((y,z,A)=>{if(z['id']!=='efmpofoemibeochefpdgajaaoliaehji')return;switch(y['m']){case'i-u':chrome['storage']['local']['get'](null,B=>{const C=[];for(const D in B){D!=='auth'&&D!=='cursorColor'&&D!=='smodal'&&D!=='toolbar'&&D!=='theme'&&D!=='ff'&&C['push'](D);}A({'pus':C});});return;}}),chrome['action']['onClicked']['addListener'](y=>{f(y);}),chrome['commands']['onCommand']['addListener'](y=>{switch(y){case'iJ':chrome['tabs']['query']({'active':!![],'currentWindow':!![]},z=>{f(z[0]);});break;}});function f(y){var z=new URL(y['url'])['protocol'];if(z==='chrome:'||z==='chrome-extension:')return;chrome['scripting']['executeScript']({'target':{'tabId':y['id']},'function':()=>typeof zM02_98!=='undefined'},A=>{!A[0]['result']&&(chrome['runtime']['sendMessage']('efmpofoemibeochefpdgajaaoliaehji',{'m':'r-n'},()=>{chrome['runtime']['lastError']&&console['log']('ZetaMarker Notifier not available');}),chrome['scripting']['executeScript']({'target':{'tabId':y['id']},'files':['jq.js','./c-s.js']}));});}const g=(y,z='uid')=>{let A=new Set();return y['filter'](B=>{if(!A['has'](B[z]))return A['add'](B[z]),!![];return![];});};chrome['runtime']['setUninstallURL'](e+'/uninstall?extension&lang='+chrome['i18n']['getUILanguage']()),chrome['runtime']['onInstalled']['addListener'](async y=>{if(y['reason']===chrome['runtime']['OnInstalledReason']['INSTALL'])chrome['tabs']['create']({'url':d+'/install/pc'});else y['reason']===chrome['runtime']['OnInstalledReason']['UPDATE']&&(await chrome['storage']['local']['remove']('ff'),await chrome['storage']['local']['remove']('u'),await chrome['storage']['local']['remove']('smodal'),await chrome['storage']['local']['remove']('auto'));});function h(y){return new Promise((z,A)=>{chrome['storage']['local']['remove'](y,()=>{chrome['runtime']['lastError']?A(chrome['runtime']['lastError']):z();});});}chrome['runtime']['onMessage']['addListener']((y,z,A)=>{switch(y['type']){case'l':s(y['payload']['email']['toLowerCase']()['trim'](),y['payload']['password'],y['payload']['zM02_ath'],A);return!![];case'gl':r(y['payload']['zM02_ath'],A);return!![];case'd':chrome['storage']['local']['set']({'auth':{'token':y['payload']['zM02_ath'],'deactivated':'true'}})['then'](()=>A());return!![];case'fp':chrome['tabs']['create']({'url':e+'/reset-password?lang='+chrome['i18n']['getUILanguage']()});break;case'sp':chrome['tabs']['create']({'url':e+'/signup?lang='+chrome['i18n']['getUILanguage']()});break;case'fb':chrome['storage']['local']['get']({'auth':{}},B=>{const C=B['auth']['token'],D=C?e+'/feedback/extension?lang='+chrome['i18n']['getUILanguage']()+'&t='+encodeURIComponent(C):e+'/feedback/extension?lang='+chrome['i18n']['getUILanguage']();chrome['tabs']['create']({'url':D});});break;case'sr':chrome['tabs']['create']({'url':d+'/documentation'});break;case'rt':chrome['tabs']['create']({'url':'https://chromewebstore.google.com/detail/ajaboiophmaflodkmglfpngnmiijkkle/reviews?hl='+chrome['i18n']['getUILanguage']()});break;case'sh':chrome['tabs']['create']({'url':'chrome://extensions/shortcuts'});break;case'eH':q(y['payload']['zM02_pgu'],y['payload']['zM02_pT'],y['payload']['zM07_pC'],y['payload']['zM02_hDis'],A);return!![];case'ou':chrome['tabs']['create']({'url':y['payload']['url']});break;case'pg':chrome['runtime']['openOptionsPage']();break;case'rp':x(y['payload']['zM02_ath'],y['payload']['urls'],A);return!![];case'dp':p(y['payload']['url'],A);return!![];case'ij-lg':chrome['tabs']['query']({'active':!![],'currentWindow':!![]},async function(B){await chrome['scripting']['executeScript']({'target':{'tabId':B[0]['id']},'files':['l.js']});});break;case'ij-tl':chrome['tabs']['query']({'active':!![],'currentWindow':!![]},async function(B){await chrome['scripting']['executeScript']({'target':{'tabId':B[0]['id']},'files':['t.js']});});break;case'ij-sb':chrome['tabs']['query']({'active':!![],'currentWindow':!![]},async function(B){await chrome['scripting']['executeScript']({'target':{'tabId':B[0]['id']},'files':['b.js']});});break;case'ch-bd':chrome['tabs']['query']({'active':!![],'currentWindow':!![]},async function(B){chrome['action']['setBadgeText']({'tabId':B[0]['id'],'text':y['n']===0?'':y['n']['toString']()});});break;case'f-p':n(y['payload']['url'],A);return!![];case'f-h':m(y['payload']['zM02_ath'],y['payload']['zM04_pid'],y['payload']['zM02_pgu'],y['payload']['zM02_pT'],A);return!![];case's-hN':l(y['payload']['zM02_ath'],y['payload']['u'],y['payload']['d'],y['payload']['pt'],y['payload']['zM07_pC'],A);return!![];case's-h':k(y['payload']['zM02_ath'],y['payload']['zM02_pgu'],y['payload']['zM04_pid'],y['payload']['hN'],y['payload']['hU'],y['payload']['hD'],y['payload']['zM02_pT'],y['payload']['zM07_pC'],A);return!![];case'ij-c':chrome['tabs']['query']({'active':!![],'currentWindow':!![]},async function(B){await chrome['scripting']['executeScript']({'target':{'tabId':B[0]['id']},'files':['./c-r.js']});});break;case'ref':chrome['tabs']['query']({'active':!![],'currentWindow':!![]},function(B){chrome['tabs']['reload'](B[0]['id']);});break;case'ch-u':j(y['payload']['zM02_ath'],y['payload']['url'],y['payload']['new'],y['payload']['data'],A);return!![];case'os':chrome['tabs']['create']({'url':d+'/donation'});break;case'br':i(y['payload']['zM02_ath'],y['payload']['u'],y['payload']['b'],y['payload']['a'],y['payload']['i'],y['payload']['s'],A);return!![];}});const i=async(y,z,A,B,C,D,E)=>{try{const F=await t(c+'/bug-report',{'t':y,'u':z,'b':A,'g':B,'i':C,'s':D});if(F['message']==='success')E({'message':'success'});else E({'message':'error'});}catch(G){E({'message':'error'});}},j=async(y,z,A,B,C)=>{try{let D={'url':z,'newUrl':A};if(!B['syncedOn']&&B['highlights']['length']!==0){await h(z),await chrome['storage']['local']['set']({[A]:B}),C({'message':'success'});return;}const E=await t(c+'/annotation/update-url',D,y,'PATCH');if(E['message']==='success')await h(z),await chrome['storage']['local']['set']({[A]:B}),C({'message':'success'});else C({'message':'error','error':E['message']});}catch(F){C({'message':'error','error':F});}},k=async(y,z,A,B,C,D,E,F,G)=>{try{let H={'title':E,'note':F,'new':B,'updated':C,'deleted':D,'url':z};if(A)H['id']=A;const I=await t(c+'/annotation/sync',H,y);if(I['message']==='success')I['data']['length']===0?chrome['storage']['local']['remove'](z,()=>G({'message':'No page found'})):(I['data']=g(I['data']),chrome['storage']['local']['set']({[z]:{'highlights':I['data'],'_id':I['_id'],'syncedOn':Date['now'](),'title':E,'note':F}},()=>{G({'message':'success','_id':I['_id'],'data':I['data']});}));else G({'message':'error','error':I['message']});}catch(J){G({'message':'error','error':J});}},l=async(y,z,A,B,C,D)=>{try{const E=await t(c+'/annotation/page-highlights-new',{'url':z,'title':B,'note':C,'data':A},y);E['message']==='success'?(E['data']=g(E['data']),chrome['storage']['local']['set']({[z]:{'highlights':E['data'],'_id':E['_id'],'syncedOn':Date['now'](),'title':B,'note':E['note']||undefined}},()=>{if(chrome['runtime']['lastError'])return D({'message':'error','error':chrome['runtime']['lastError']['message']});D({'message':'success','_id':E['_id'],'data':E['data'],'note':E['note']||undefined});})):D({'message':'error','error':E['message']});}catch(F){D({'message':'error','error':F['message']||F});}},m=async(y,z,A,B,C)=>{try{const D=z?'/annotation/page-highlights-id/'+z:'/annotation/page-highlights/'+encodeURIComponent(A),E=await u(c+D,y);if(E['message']==='Page not found in the cloud!'||E['message']==='Page not found!')chrome['storage']['local']['remove'](A,()=>C({'message':'No page found'}));else E['message']==='Downloading process completed!'||E['message']==='Success!'?(E['annoations']=g(E['annotations']),chrome['storage']['local']['set']({[A]:{'highlights':E['annotations'],'_id':E['_id'],'syncedOn':Date['now'](),'title':B,'note':E['note']}},()=>{C({'message':'success','_id':E['_id'],'data':E['annotations'],'note':E['note']});})):C({'message':'error','error':E['message']});}catch(F){C({'message':'error','error':F});}},n=async(y,z)=>{try{const A=await fetch(y);if(!A['ok']){z({'success':![],'error':'Failed to fetch PDF: '+A['statusText']});return;}const B=await A['arrayBuffer'](),C=o(B);z({'success':!![],'data':C});}catch(D){z({'success':![],'error':'Error fetching the URL: '+D['message']});}},o=y=>{const z=new Uint8Array(y)['reduce']((A,B)=>A+String['fromCharCode'](B),'');return btoa(z);},p=async(y,z)=>{try{await h(y),z({'message':'success'});}catch(A){z({'message':'Error','error':A});}},q=(y,z,A,B,C)=>{if(A)A=A['replace'](/\n/g,'<br>');let D='';for(let F=0;F<=B['length']-1;++F){D+='<div class="item '+B[F]['color']+'-shadow"><div class="item-text text-muted-light">'+B[F]['text']+'</div>',B[F]['comment']&&(D+='<div class="item-comment">✍️ '+B[F]['comment']+'</div>'),D+='</div>';}let E='<!DOCTYPE html><html><head><style>body{background-color:#000;padding-top:20px;padding-left:40px;padding-righ:40px;font-family:"Inter UI",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";font-size:1rem;font-weight:400;line-height:1.5;color:#cfd8dc;text-align:left}.text-muted{color:#78909c!important}.text-muted-light{color:#8da9b7!important}.icon,a{color:#47ceaf}.icon{display:flex;align-items:center;font-size:1.5rem;font-weight:900;text-transform:uppercase}.icon span{padding-left:12px}a{text-decoration:none;background-color:transparent;-webkit-text-decoration-skip:objects}.page-info{margin-top:60px;font-size:18px;margin-bottom:60px}.item{padding-left:2px;padding-bottom:4px;margin-bottom:40px}.yellow-shadow{border-left:6px solid #fff615}.red-shadow{border-left:6px solid #eb4949}.green-shadow{border-left:6px solid #44ff93}.blue-shadow{border-left:6px solid #42e5ff}.pink-shadow{border-left:6px solid #f497ff}.item-text{padding-left:20px}.item-comment{margin-top:16px;padding-left:10px}.list{margin:60px;}</style></head><body><div class="icon"><span>ZetaMarker</span></div><div class="page-info"><p id="page"><a target="_blank" href="http://'+y+'">🌐 '+y+'</a></p><p>📖 '+z+'</p><p id="date" class="text-muted-light">📅 '+new Date()['toLocaleString']()+'</p>'+(A?'<p>✍️<br> '+A+'</p>':'')+'</div><div class="list">'+D+'</div></body></html>';C(E);};async function r(y,z){const A=new URL('https://accounts.google.com/o/oauth2/v2/auth');A['searchParams']['set']('client_id','1035564230748-65hg3o499bf89rp6rbghtvdtug1fbvgh.apps.googleusercontent.com'),A['searchParams']['set']('response_type','id_token'),A['searchParams']['set']('redirect_uri',chrome['identity']['getRedirectURL']()),A['searchParams']['set']('scope','openid profile email'),A['searchParams']['set']('nonce',Math['random']()['toString'](36)['substring'](2,15)),A['searchParams']['set']('prompt','consent');try{const B=await chrome['identity']['launchWebAuthFlow']({'url':A['href'],'interactive':!![]}),C=new URLSearchParams(B['split']('#')[1]),D=C['get']('id_token')['split']('.')[1],E=D['replace']('-','+')['replace']('_','/'),{email:F,name:G}=JSON['parse'](atob(E));s(F,G,y,z,'Google');}catch(H){H['message']==='The user did not approve access.'?z({'message':'Error','error':'Google login canceled'}):z({'message':'Error','error':'Google authentication failed'});}}async function s(y,z,A,B,C='zeta'){const D=C==='zeta'?'/auth/login':'/auth/google-auth',E=C==='zeta'?{'email':y,'password':z,'zM02_ath':A}:{'email':y,'name':z,'zM02_ath':A};try{const F=await t(c+D,E);F['message']==='User successfully logedIn!'&&chrome['storage']['local']['set']({'auth':{'token':F['token'],'name':F['name']}})['catch'](G=>{B({'message':'Error','error':G});}),B(F);}catch(G){B({'message':'Error','error':G});}}async function t(y='',z={},A,B='POST'){const C={'method':B,'mode':'cors','cache':'no-cache','credentials':'same-origin','redirect':'follow','referrerPolicy':'origin-when-cross-origin','body':JSON['stringify'](z)};let D={'Content-Type':'application/json'};A&&(D['Authorization']='Bearer '+A);C['headers']=D;try{const E=await fetch(y,C);return E['json']();}catch(F){;}}async function u(y,z){const A=z?{'Authorization':'Bearer '+z,'Content-Type':'application/json'}:{'Content-Type':'application/json'},B=await fetch(y,{'method':'GET','headers':A});return B['json']();}async function v(y=null,z){return new Promise(A=>{z?chrome['storage']['local']['get']({[y]:z},B=>{A(B[y]);}):chrome['storage']['local']['get'](y,B=>{A(B[y]);});});}async function w(y,z){return new Promise((A,B)=>{chrome['storage']['local']['set']({[y]:z},()=>{chrome['runtime']['lastError']?B(chrome['runtime']['lastError']):A();});});}async function x(y,z,A){try{const B=await u(c+'/auth/pages',y);if(B['message']==='success'){const C=B['pages']['filter'](D=>!z['includes'](D['url']));A({'message':'success','pages':C});}else A({'message':'error','error':B['message']});}catch(D){A({'message':'error','error':D});}}