import{a as V}from"./KOLF3YRK.js";import{a as G,b as H}from"./ADNQVRZ5.js";import{b as g,c as K}from"./BYL62TPW.js";import{B as D,C as k,D as U,E as q,G as $}from"./W76RXALD.js";import{a as l,g as O,h as B,i as p}from"./4VYUSQN4.js";import{c as T}from"./JVSFDP7Y.js";import{H as L,n as A,y as _}from"./RHEDGG6N.js";import{Ca as M,ja as N}from"./DPE42NE6.js";import{Aa as v,Q as R,Ub as b,ka as d,mb as P,ra as F,s as C}from"./ONVH27HX.js";import{a as I}from"./PJ57C2TE.js";import{f as S}from"./GAV6HCJA.js";var E=S(I());var j=async(n,e)=>(n&&n.contentWindow,new Promise(async t=>{let s=new l,r=d();(await s.postMessage({event:"Client_findIframePageCitation",data:{taskId:r,citation:e}})).success||t(!1);let o=setTimeout(()=>{t(!1),E.default.runtime.onMessage.removeListener(a)},1e4),a=c=>{c.id===T&&c.event==="Client_listenFindIframePageCitationResponse"&&c.data.taskId===r&&(t(c.data.isMatched),E.default.runtime.onMessage.removeListener(a),clearTimeout(o))};E.default.runtime.onMessage.addListener(a)}));var w=S(I());var X=async()=>{if(v())return"";let n=F(),e=typeof window<"u"?window.location.href:"",t="";return n==="docs.google.com"?t=await Z():n==="github.com"?t=await ee():e.match("onedrive.live.com/edit")||e.match(/onedrive\.live\.com\/personal\/[^/]+\/.*\.aspx/)||e.match("word.cloud.microsoft/open/onedrive")?t=await y():e.match("icloud.com/mail")?t=await y():e.match("navigator-lxa.mail.com/mail")&&(t=await y()),t.trim()},W=async(n,e)=>(n&&n.contentWindow,new Promise(async t=>{let s=new l,r=d();(await s.postMessage({event:"Client_createIframePageDocument",data:{taskId:r,pageUrl:e}})).success||t(null);let o=setTimeout(()=>{t(null),w.default.runtime.onMessage.removeListener(a)},1e4),a=async c=>{if(c.id===T&&c.event==="Client_listenCreateIframePageDocumentResponse"&&c.data.taskId===r){let m=c.data.pageDocument,u=await P.createDocFile(m.doc_type,m.doc_type_dependent_data||{},m.doc_type==="page_content__webpage"?{pureText:m.pure_text}:void 0);t({...m,file:u}),w.default.runtime.onMessage.removeListener(a),clearTimeout(o)}};w.default.runtime.onMessage.addListener(a)})),y=async()=>new Promise(async n=>{let e=new l,t=d();(await e.postMessage({event:"Client_getIframePageContent",data:{taskId:t}})).success||n("");let r=setTimeout(()=>{n(""),w.default.runtime.onMessage.removeListener(i)},1e4),i=o=>{o.id===T&&o.event==="Client_listenGetIframePageContentResponse"&&o.data.taskId===t&&(n(o.data.pageContent),w.default.runtime.onMessage.removeListener(i),clearTimeout(r))};w.default.runtime.onMessage.addListener(i)}),Z=async()=>new Promise(n=>{let e=d(),t=setTimeout(()=>{n(""),window.removeEventListener(`${e}-result`,s)},1e4),s=r=>{n(r.detail.pageContent),clearTimeout(t)};window.addEventListener(`${e}-result`,s,{once:!0}),window.dispatchEvent(new CustomEvent("MAXAI_LOAD_GOOGLE_DOC_CONTENT",{detail:{id:e}}))}),ee=async()=>{let n=new URL(location.href),e=n.pathname,t=e.split("/")[1],s=e.split("/")[2];if(document.querySelector("#copilot-button-positioner")){let r=e.split("/").pop(),i="";i+=`## File Information
`,i+=`- Repository Name: [${s}](${n.origin}/${t}/${s})
`,i+=`- File Name: ${r}
`,i+=`- File Path: ${e}
`,i+=`- File Source link: ${n.href}
`,i+=`## File Content
`;let o="N/A",a=document.querySelector('a[data-testid="raw-button"]'),c="";if(a){let m=await g(a.href,{method:"GET",parse:"text"});m?.success&&(o=m.data||"N/A");let u=a.href.split("/").pop();c=R(u?.split(".").pop()||"")}return i+=`\`\`\`${c}
${o}
\`\`\`
`,i}else if(/issues\/\d+/.test(e)){let r=a=>{if(!a)return{author:"",date:"",content:"",metadata:""};let c=a.querySelector("a.author"),m=a.querySelector("relative-time"),u=a.querySelector(".user-select-contain")||a.querySelector("table"),f=a.querySelector(".timeline-comment-header div > span > span");return{author:c?.innerText||"",date:m?.getAttribute("datetime")||m?.title||"",content:u?.innerText.replace(/\n\s+/g,`
`).replace(/\n{2,}/g,`

`).trim()||"N/A",metadata:f?.innerText||"Commenters"}},i=document.querySelector(".js-issue-title"),o=document.querySelector(".js-discussion > div");if(o){let a=[r(o)],c=new URL(window.location.href);c.pathname=c.pathname+"/partials/load_more";let m=await g(c.href,{method:"GET",parse:"text"});m?.success&&new DOMParser().parseFromString(m?.data||"","text/html").querySelectorAll(".js-timeline-item").forEach(z=>{a.push(r(z))});let u="";return u+=`## ${i?.innerText}
`,u+=`- Repository Name: [${s}](${n.origin}/${t}/${s})
`,u+=`- Repository issue link: ${n.href}
`,a.forEach((f,h)=>{u+=`### Comment ${h+1}
`,u+=`- Author: ${f.author}
`,u+=`- Date: ${f.date}
`,u+=`- Metadata: ${f.metadata}
`,u+=`${f.content}
`}),u}}return""};var te=async(n,e)=>(await new l({runtime:"shortcut"}).postMessage({event:"ShortCuts_OperationPageElement",data:{OperationElementConfig:e,OperationElementTabID:n}})).data,Y=te;var ne=async()=>{let n="MAXAI_CURRENT_TAB_NET_REQUEST_SESSION_RULE_ID",e=Number(await C.getItem(n))||1e3;return e>2e4&&(e=1e3),await C.setItem(n,e+1),e},J=async n=>{let s=(await p("tabs","query",[{active:!0,currentWindow:!0}]))?.[0]?.id;if(!s)return!1;if(n.addRules){n.addRules=n.addRules.map(o=>b([o,{condition:{tabIds:[s]}}]));let i=await p("declarativeNetRequest","getSessionRules",[]);i?.length&&(n.addRules=n.addRules.filter(o=>!i.find(c=>N(o,{...c,id:o.id}))));for(let o of n.addRules)o.id=await ne()}let r=await p("declarativeNetRequest","updateSessionRules",[n]);return!0},Q=async()=>{let t=(await p("tabs","query",[{active:!0,currentWindow:!0}]))?.[0]?.id;if(!t)return!1;let r=(await p("declarativeNetRequest","getSessionRules",[]))?.filter(o=>o.condition.tabIds?.includes(t));if(!r?.length)return!0;let i=await p("declarativeNetRequest","updateSessionRules",[{removeRuleIds:r.map(o=>o.id)}]);return!0};var re=async n=>(await new l({runtime:"client"}).postMessage({event:"Client_syncAuthInfo",data:n})).data,x=class{constructor(){this.openPage=O;this.closePage=B;this.proxyFetch=g;this.abortProxyFetch=K;this.getSpecialHostPageContent=X;this.operationPageElement=Y;this.showSidebar=G;this.hideSidebar=H;this.createFileStreamer=async(e,t)=>{let r=await new l({runtime:"client"}).postMessage({event:"Client_createFileStreamer",data:{fileUrl:e,chunkSize:t}});return r.success?r.data:new Error(r.message)};this.destroyFileStreamer=async e=>(await new l({runtime:"client"}).postMessage({event:"Client_destroyFileStreamer",data:{taskId:e}})).data;this.getFileNextChunk=async(e,t)=>(await new l({runtime:"client"}).postMessage({event:"Client_getFileNextChunk",data:{taskId:e,chunkSize:t}})).data;this.updateCurrentTabNetRequestSessionRules=J;this.clearCurrentTabNetRequestSessionRules=Q;this.syncUserTokens=re;this.injectScript=async(e,t)=>new Promise(s=>{let r=d(),i=setTimeout(()=>{s(null),window.removeEventListener(`${r}-result`,o)},2e3),o=()=>{s(!0),clearTimeout(i)};window.addEventListener(`${r}-result`,o,{once:!0}),window.dispatchEvent(new CustomEvent("MAXAI_INJECT_SCRIPT",{detail:{id:r,src:e,attrs:t}}))});this.pingIframePage=async()=>!0;this.findIframePageCitation=j;this.createIframePageDocument=W;this.getExtensionPinedStatus=async()=>(await p("action","getUserSettings",[]))?.isOnToolbar||!1;this.getExtensionPublicConfig=async()=>({onboardingMap:await $(),currentActiveModalKey:D,currentActiveTopBarKey:k,currentUploadModalKey:U,currentTourKey:q});this.checkSettingsUpdate=async()=>{try{return await _.isLogin()?(await L.getAppSettings(!0),!0):!1}catch{return!1}};this.getCurrentTabScreenshot=V;this.getExtensionUserTokens=async()=>await A.getAuthTokens();this.openNewTab=async(e,t)=>(await new l().postMessage({event:"Client_openNewTab",data:{url:e,options:t}})).data;this.openNewTabAndPollCheckTabAlive=async(e,t)=>(await new l().postMessage({event:"Client_openNewTabAndPollCheckTabAlive",data:{url:e,options:t}})).data}async setPricingClosedRedirectUrl(...e){return new l({runtime:"client"}).postMessage({event:"Client_createPaymentUrl",data:e[0]}),!0}};function qe(){M(x)}export{re as a,qe as b};
