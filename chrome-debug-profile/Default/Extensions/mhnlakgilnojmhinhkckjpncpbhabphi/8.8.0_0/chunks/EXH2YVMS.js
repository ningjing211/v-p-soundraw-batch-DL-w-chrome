import{b as Ae}from"./PW2PVNG6.js";import{i as Le,q as p}from"./Z2GQCHLU.js";import{a as B}from"./P3KYY2HQ.js";import{Ea as b,H as T,N as k,O as De,P as Ee,Pa as Ne,Q as C,R as Se,W as xe,Z as be,aa as R,ba as Me,c as Ie,ca as F,da as Pe,ea as _e,fa as H,ha as Te,ja as Re,ma as W,oa as x,qa as Fe,s as ve,u as ye}from"./DPE42NE6.js";import{Ba as se,c as Ce,mb as we,xa as ge}from"./ONVH27HX.js";import{l as pe,o as he}from"./WUP5AHVL.js";var $=s=>s?.type==="page_content__webpage",U=s=>s?.type==="page_content__email",q=s=>s?.type==="page_content__youtube",Y=s=>s?.type==="page_content__youtube_comment",N=s=>s?.type==="page_content__pdf",G=s=>s?.type==="audio",z=s=>s?.type==="search_results",M=s=>s?.type==="chat_file";var P=class extends Ie{constructor(){super(...arguments);this.audioPlayer=null;this.startTime=0}setStartTime(t){this.startTime!==t&&(this.startTime=t,this.emit("onChangeStartTime",{startTime:this.startTime}))}setAudioPlayer(t){this.audioPlayer=t}seekTo(t){this.audioPlayer&&(this.audioPlayer.currentTime=t)}play(){this.audioPlayer&&this.audioPlayer.play()}pause(){this.audioPlayer&&this.audioPlayer.pause()}setVolume(t){this.audioPlayer&&(this.audioPlayer.volume=t)}setMuted(t){this.audioPlayer&&(this.audioPlayer.muted=t)}};var Xe=new P;var X=class{async find(e,t){if(G(e.source)&&B(e.source.start_time)){let{doc_id:r,start_time:o}=e.source,i=await p.downloadDocument(r),n=await p.previewDocument(r,{title:i.data?.doc_type_dependent_data?.title||t?.title||"Audio",viewerProps:{}},{waitToLoaded:!0});return n.viewerController instanceof P&&(n.viewerController.seekTo(o),n.viewerController.play()),!0}return!1}};var Ve=new X;var Oe=s=>s.replace(/\s?\(.*?\)\s?/g,""),j=class{async find(e,t){if(!U(e.source))return!1;let r=e.source,{doc_id:o,url:i}=r;if(i&&i!==window.location.href){let l=await p.downloadDocument(o),m=await p.previewWebpage(i,{title:l.data?.doc_type_dependent_data?.title||t?.title||"Title"},{waitToLoaded:!0});return m.viewerController instanceof x&&m.viewerController.iframeElement?!!await b.findIframePageCitation(null,e):!1}let a=(await be(null)).emails.find(l=>Oe(l.date)===Oe(r.date)&&Re(l.from,r.from));if(a?.contentElement){xe(a.contentElement)||a.dateElement?.click();let l=[],m=ye(a.contentElement);if(m.forEach(c=>{let f=c.textContent||"";l.push({text:f,parentElement:c.parentElement,textNode:c,startOffset:0,endOffset:f.length})}),m.length)return await C(l),!0}return!1}};var le=new j;var K=class{constructor(){this.viewerController=null;this.caches=new Map;this.loading=!1}reset(){if(!this.viewerController?.containerElement){this.caches.clear(),this.loading=!1;return}}async highlightMatches(e){if(!e.length||!this.viewerController?.scrollElement)return;let t=this.viewerController.scrollElement,r=e[0].rowIndex,o=e[0].colIndex,i=e[0].rowIndex,n=e[0].colIndex;e.forEach(d=>{d.rowIndex<r&&(r=d.rowIndex),d.colIndex<o&&(o=d.colIndex),d.rowIndex>i&&(i=d.rowIndex),d.colIndex>n&&(n=d.colIndex)});let a=(i-r+1)*F,l=(n-o+1)*Pe,m=t.clientHeight-F,c=t.clientWidth-_e,f=this.viewerController.getRowOffsetTop(r,"start"),u=this.viewerController.getColOffsetLeft(o,"start");a<m&&(f=Math.max(f-(m-a)/2,0)),l<c&&(u=Math.max(u-(c-l)/2,0)),t.scrollTo({top:f,left:u,behavior:"smooth"}),await T(async()=>{let d=this.viewerController?.containerElement?.querySelector(e[0].parentSelector||""),v=Math.min(i,Math.ceil(f/F)+Math.ceil(m/F)),E=this.viewerController?.containerElement?.querySelector(`.maxai-document--excel-viewer-content-row--${v} .maxai-document--excel-viewer-content-col--${o}`);if(!d||!E)throw new Error("")},50,100);let w=e.map(d=>{let v=this.viewerController?.containerElement?.querySelector(d.parentSelector||"");return v&&ve(v)&&v.classList.add("maxai-reading-highlight"),v}),D=()=>{w.forEach(d=>{d&&d.classList.remove("maxai-reading-highlight")}),document.body.removeEventListener("mousedown",D)};document.body.addEventListener("mousedown",D)}async findText(e){if(this.reset(),!this.viewerController?.containerElement||!this.viewerController?.scrollList||!this.viewerController?.headers.length||(e=e.replace(/\r\n/g,`
`),e=e.replace(/\s+/g,""),e=e.replace(/"/g,""),e=e.replace(/,/g,""),!e)||this.loading)return!1;if(this.loading=!0,this.caches.get(e)){let n=this.caches.get(e);if(n.find(l=>l.parentElement&&!document.contains(l.parentElement)))this.caches.delete(e);else return await this.highlightMatches(n),this.loading=!1,!0}let t=[],r="",{headers:o,rows:i}=this.viewerController;return i.some((n,a)=>{for(let l=0;l<o.length;l++){let m=o[l],c=n[m],f=String(c);c==null&&(f="");for(let u of f)if(!(u===""||u===" "||u===`
`||u==="\r"||u==='"'||u===","))if(u===e[r.length]){if(r.length,r+=u,r.length===e.length)break}else t=[],r="";if(r.length&&t.push({text:f,textNode:null,startOffset:0,endOffset:f.length,parentSelector:`.maxai-document--excel-viewer-content-row--${a} .maxai-document--excel-viewer-content-col--${l}`,rowIndex:a,colIndex:l}),r.length===e.length)return!0}}),t.length&&(this.caches.set(e,t),await this.highlightMatches(t)),this.loading=!1,t.length>0}async find(e,t){if(this.reset(),!M(e.source))return!1;let r=await p.downloadDocument(e.source.doc_id),o=await p.previewDocument(e.source.doc_id,{title:t?.title||"Chat File",viewerProps:{fileSize:r.data?.file_size||0}},{waitToLoaded:!0});return o.viewerController instanceof H&&(this.viewerController=o.viewerController),this.findText(e.content)}};var ke=new K;var Z=class{constructor(){this.viewerController=null;this.caches=new Map;this.loading=!1}reset(){if(!this.viewerController?.containerElement){this.caches.clear(),this.loading=!1;return}}async findText(e,t){if(this.reset(),!this.viewerController?.containerElement||(e=e.replace(/\r\n/g,`
`),e=e.replace(/\s+/g,""),!e))return!1;if(this.caches.get(e)){let o=this.caches.get(e);if(o.find(n=>n.parentElement&&!document.contains(n.parentElement)))this.caches.delete(e);else return await C(o,{strictMatch:!0}),!0}if(this.loading)return!1;this.loading=!0;let r=k(this.viewerController.containerElement,e);return r.length&&(this.caches.set(e,r),await C(r,{strictMatch:!0})),this.loading=!1,r.length>0}async find(e,t){if(this.reset(),!M(e.source))return!1;let r=await p.downloadDocument(e.source.doc_id),o=await p.previewDocument(e.source.doc_id,{title:t?.title||"Chat File",viewerProps:{fileSize:r.data?.file_size||0}},{waitToLoaded:!0});if(o.viewerController instanceof H)return ke.find(e,t);o.viewerController instanceof Te&&(this.viewerController=o.viewerController);let i=e.source?.start_index||e.start_index;return this.findText(e.content,i)}};var He=new Z;var J=class{constructor(){this.chatFiles=new Map;this.currentFile=null;this.viewerController=new W}cacheChatFile(e,t){let r=this.chatFiles.get(e);r?this.chatFiles.set(e,{...r,...t}):this.chatFiles.set(e,t)}async init(e){}async reset(){this.currentFile=null,this.viewerController.reset()}async compressPDFFile(e,t){let{password:r,onCompress:o}=t||{},i=null,n=async()=>(typeof i=="boolean"||(o?i=await o():i=!0),i),a=400,l=!0,m=we.MAX_FILE_SIZE,c=await e.arrayBuffer(),f=new Le(c,{createDate:new Date(e.lastModified),modifiedDate:new Date(e.lastModified),password:r});if(await f.init(),!f.pdfDoc)throw new Error(he);let u=f.pdfDoc.getPageCount();if(u<=a&&e.size<m)return e;if(u>a){if(!await n())return e;await f.cropByPageCount(a)}if(!await n())return e;let w=await f.cropByFileSize(m,{removeImage:l}),D=new Blob([w],{type:e.type});return new File([D],e.name,{type:e.type,lastModified:e.lastModified})}async gotoPage(e,t="scroll-list",r="center"){this.viewerController.gotoPage(e,t,r)}};var We=new J;var Q=(s=null)=>{if(s){let e={parent:s,children:[],index:s.children.length};return s.children.push(e),e}return{parent:s,children:[],index:0}},ee=class{constructor(){this.viewerController=null;this.caches=new Map;this.loading=!1;this.pages=[];this.mark=null}reset(e){this.viewerController=e,this.mark?.remove(),this.mark=null,this.viewerController?.pdfDocument||(this.caches.clear(),this.loading=!1)}async renderPage(e){document.querySelector(`#pdf-page-${e}`)||await this.viewerController?.gotoPage(e)}async renderPages(e){for(let t of e)await this.renderPage(t)}async scrollElement(e){let t=document.querySelector(".pdf-list-scroll");if(!t||!e)return;let r=t.getBoundingClientRect(),o=e instanceof Element?e.getBoundingClientRect():e;if(o.top>r.top&&o.bottom<r.bottom)return;let n=o.top-r.top+t.scrollTop-50;t.scrollTo({top:n,behavior:"auto"})}async highlightMatches(e){if(!e)return;let t=e[0],r=e[e.length-1];return await this.renderPage(t.pageNum),await this.renderPages(Array(r.pageNum-t.pageNum+1).fill("").map((o,i)=>t.pageNum+i)),C(e,{behavior:"auto"})}async selectMatches(e){if(!e.length)return;let t=e[0],r=e[e.length-1];await this.renderPage(t.pageNum),await this.renderPages(Array(r.pageNum-t.pageNum+1).fill("").map((l,m)=>t.pageNum+m));let o=document.createRange(),i=l=>{if(l===r&&t&&l.pageNum-t.pageNum>4){let c=document.querySelector(`#pdf-page-${t.pageNum+4} .textLayer span[role="presentation"]:last-of-type`);if(c)return c}return De(l)},n=i(t),a=i(r);if((!n||!a)&&await T(async()=>{if(n=i(t),a=i(r),!n||!a)throw new Error("")},50,100),!n||!a){let l=document.querySelectorAll(`#pdf-page-${t.pageNum} .textLayer span[role="presentation"]`);n=l[0],a=l[l.length-1]}if(n&&a){o.setStart(n.firstChild,0),o.setEnd(a.firstChild,a.lastChild?.nodeValue?.length||0);for(let m=t.pageNum;m<=r.pageNum;m++){let c=document.querySelector(`#pdf-page-${m} .react-pdf__Page__annotations`);c&&(c.style.display="none")}let l=window.getSelection();l&&(l.removeAllRanges(),l.addRange(o),await this.scrollElement(l.getRangeAt(0).getBoundingClientRect()),await Ee(n,100));for(let m=t.pageNum;m<=r.pageNum;m++){let c=document.querySelector(`#pdf-page-${m} .react-pdf__Page__annotations`);c&&(c.style.display="")}}}async findText(e,t){if(this.reset(this.viewerController),e=e.replace(/\r\n/g,`
`),e=e.replace(/\s+/g,""),!e)return!1;if(this.caches.get(e)){let l=this.caches.get(e);return await this.selectMatches(l),!0}if(this.loading||!this.viewerController?.pdfDocument)return!1;this.loading=!0;let r=Date.now(),o=this.viewerController.pdfDocument,i=o.numPages,n=[],a="";try{let l=async(u,w)=>{let D=0;for(let d=u;d<=w;d++){if(typeof this.pages[d-1]=="number"&&(D+=this.pages[d-1],typeof t=="number"&&t>D-1))continue;let E=await(await o.getPage(d)).getTextContent({includeMarkedContent:!0}),A=Q(),y=A,_=0,L=0;if(E.items.some((g,V)=>{let I=g;if(I.type==="beginMarkedContentProps"||I.type==="beginMarkedContent"){y=Q(y);return}if(I.type==="endMarkedContent"){y=y?.parent||null;return}let O=Q(y),fe=0,ne=0,ie=!1,S=I.str?.replace(/\s+/g,"")||"";_+=I.hasEOL?I.str.length+1:I.str.length,L=V,I.hasEOL&&I.str&&Q(y);for(let h=0;h<S.length;h++)if(S[h]===e[a.length]){if(a.length||(fe=h,ne=h,ie=!0),a+=S[h],a.length===e.length){ne=h;break}}else a&&(ie?h=fe:h--),n=[],a="",ie=!1;if(a.length&&(!n.length||a.length===e.length)){let h=y,ae="";for(;h&&h!==A;)ae=` > .markedContent:nth-child(${h.index+1})`+ae,h=h.parent;let de=`#pdf-page-${d} .textLayer${ae} > :nth-child(${O.index+1})`;n.length||n.push({pageNum:d,text:S,textNode:null,startOffset:0,endOffset:S.length,parentSelector:de}),a.length===e.length&&n.push({pageNum:d,text:S,textNode:null,startOffset:0,endOffset:ne,parentSelector:de})}if(a.length===e.length)return!0}),_+=1,L===E.items.length-1&&(this.pages[d-1]=_),a.length===e.length)break}},c=1,f=i;for(;c<f||c===1&&f===1;){if(Date.now()-r>1e3*20&&!pe)throw new Error("PDF citation timeout");let u=Math.min(i,c+100);if(await l(c,u),c=u+1,a.length===e.length)break;for(;a.length>0&&c<u;)c=u+1,u=Math.min(i,c+1),await l(c,u);if(f=Math.max(u+1,f-100+1),u=Math.min(i,f+100),await l(f,u),a.length===e.length)break;for(;a.length>0&&f<u;)f=u+1,u=Math.min(i,f+1),await l(f,u)}n.length&&(this.caches.set(e,n),await this.selectMatches(n))}catch{}return this.loading=!1,n.length>0}async find(e,t){let r=ge();if(this.reset(r?We.viewerController:null),N(e.source)&&!r){let I=await p.downloadDocument(e.source.doc_id),O=await p.previewDocument(e.source.doc_id,{title:t?.title||"PDF",viewerProps:{fileSize:I.data?.file_size||0}},{waitToLoaded:!0});O.viewerController instanceof W?this.reset(O.viewerController):this.reset(null)}if(!N(e.source)||!e.source.location)return this.findText(e.content,e.start_index);if(!this.viewerController?.pdfDocument)return!1;let{page:o,bbox:i}=e.source.location,[n,a,l,m]=i,c=o+1;await this.viewerController.gotoPage(c);let f=this.viewerController.containerElement?.querySelector("div.pdf-list-scroll");if(!f)return!1;let u=`#pdf-page-${c} .react-pdf__Page`,w=f.querySelector(u);if(w||await T(async()=>{if(w=f.querySelector(u),!w)throw new Error("")},50,100),!w||!this.viewerController.pdfDocument)return!1;let d=(await this.viewerController.pdfDocument.getPage(c)).getViewport({scale:1}),v=d.width,E=d.height,A=n/v*100,y=a/E*100,_=Math.max(100-l/v*100,0),L=Math.max(100-m/E*100,0);this.mark&&(this.mark.remove(),this.mark=null);let g=document.createElement("div");g.style.position="absolute",g.style.background="linear-gradient(0deg, rgba(215, 164, 253, 0.35), rgba(215, 164, 253, 0.35)),linear-gradient(0deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.2))",g.style.boxShadow="0px 1px 2px 0px rgba(0, 0, 0, 0.04)",g.style.top=`${y}%`,g.style.left=`${A}%`,g.style.right=`${_}%`,g.style.bottom=`${L}%`,this.mark=g,w.appendChild(g);let V=()=>{this.mark&&(this.mark.remove(),this.mark=null),document.body.removeEventListener("mousedown",V)};return document.body.addEventListener("mousedown",V),this.scrollElement(g),!0}};var ce=new ee;var te=class{async find(e,t){if(!z(e.source))return!1;let{title:r,url:o}=e.source;return await p.previewWebpage(o,{title:r}),!0}};var Be=new te;var re=class{constructor(){this.caches=new Map;this.loading=!1;this.url=""}reset(){this.url&&this.url!==window.location.href&&(this.caches.clear(),this.loading=!1,this.url=window.location.href)}async findText(e,t){if(this.reset(),e.startsWith(`${document.title}

`)&&(e=e.replace(`${document.title}

`,"")),e=e.replace(/\r\n/g,`
`),e=e.replace(/\s+/g,""),!e)return!1;if(this.caches.get(e)){let o=this.caches.get(e);if(o.find(n=>n.parentElement&&!document.contains(n.parentElement)))this.caches.delete(e);else return await C(o),!0}if(this.loading)return!1;this.loading=!0;let r=k(document.body,e);return r.length&&(this.caches.set(e,r),await C(r)),this.loading=!1,r.length>0}async find(e,t){if(Se(),this.reset(),$(e.source)){let{doc_id:o,url:i}=e.source;if(i&&i!==window.location.href){let n=await p.downloadDocument(o),a=await p.previewWebpage(i,{title:n.data?.doc_type_dependent_data?.title||t?.title||i},{waitToLoaded:!0});return a.viewerController instanceof x&&a.viewerController.iframeElement?!!await b.findIframePageCitation(a.viewerController.iframeElement,e):!1}}let r=e.source?.start_index||e.start_index;return this.findText(e.content,r)}};var me=new re;var oe=class s{static jumpToTimestamp(e){if(e)try{let t=e.includes(":")?Ae(e):parseInt(e,10),r=document.querySelector("#container .ytp-ad-text.ytp-ad-preview-text-modern");if(r&&window.getComputedStyle(r).display!=="none"){Ne.warning(Ce().t("client:sidebar__summary__nav__youtube_summary__transcript__current__advertising"));return}let o=10,i=document.querySelector("#container .ytp-ad-skip-button-modern.ytp-button");i&&window.getComputedStyle(i).display!=="none"&&(o=200,i.click());let n=document.querySelector("#container video");n&&(window.scrollTo({top:0,behavior:"smooth"}),typeof t=="number"&&(n.play(),setTimeout(()=>{n.currentTime=t},o)))}catch{}}async findYoutubeComment(e,t){let r=document.getElementsByTagName("ytd-comment-thread-renderer");for(let o=0;o<r.length;o++){let i=r[o],n=i.querySelector("a#author-text"),a=i.querySelector("#content-text"),l=n?.innerText||"",m=a?.innerText||"";if(l===e&&m===t){let c={text:t,textNode:null,parentElement:a,startOffset:0,endOffset:t.length};return await C([c]),!0}}return!1}async findYoutubeTranscript(e,t,r){let o=e.querySelectorAll(".maxai--youtube-viewer--transcript-content"),i=[];return o.forEach(n=>{if(!n.parentElement)return;let a=Number(n.parentElement.getAttribute("data-start"));if(a&&a>=t&&a<=r){let l=n.textContent||"";i.push({text:l,textNode:null,startOffset:0,endOffset:l.length-1,parentElement:n})}}),await C(i),i.length>0}async find(e,t){if(Y(e.source)){let{doc_id:r}=e.source;if(R.retrieveVideoId(e.source.url)!==R.retrieveVideoId(window.location.href)){let i=se(e.source.url,["t"]),n=await p.downloadDocument(r),a=await p.previewWebpage(i,{title:n.data?.doc_type_dependent_data?.title||t?.title||i},{waitToLoaded:!0});return a.viewerController instanceof x&&a.viewerController.iframeElement?!!await b.findIframePageCitation(a.viewerController.iframeElement,{...e,source:{...e.source,url:i}}):!1}return this.findYoutubeComment(e.source.author,e.content)}if(q(e.source)&&B(e.source.start_time)){let{doc_id:r,start_time:o,end_time:i}=e.source;if(R.retrieveVideoId(e.source.url)!==R.retrieveVideoId(window.location.href)){let a=se(e.source.url,["t"]),l=await p.downloadDocument(r),m=await p.previewDocument(r,{title:l.data?.doc_type_dependent_data?.title||t?.title||a,viewerProps:{playerProps:{autoplay:!0,startTime:o}}},{waitToLoaded:!0});return m.viewerController instanceof Fe?(m.viewerController.seekTo(o),m.viewerController.isTranscriptMode&&m.viewerController.transcriptsElement?this.findYoutubeTranscript(m.viewerController.transcriptsElement,o,i):!0):!1}return s.jumpToTimestamp(`${o}`),!0}return!1}};var ue=new oe;var jr={async find(s,e){if(z(s.source))return Be.find(s,e);if($(s.source))return me.find(s,e);if(U(s.source))return le.find(s,e);if(q(s.source)||Y(s.source))return ue.find(s,e);if(G(s.source))return Ve.find(s,e);if(N(s.source))return ce.find(s,e);if(M(s.source))return He.find(s,e);switch(Me()){case"PAGE_SUMMARY":return me.find(s);case"YOUTUBE_VIDEO_SUMMARY":return ue.find(s);case"DEFAULT_EMAIL_SUMMARY":return le.find(s);case"PDF_CRX_SUMMARY":return ce.find(s);default:return!1}return!1}};export{$ as a,U as b,q as c,Y as d,N as e,z as f,oe as g,ue as h,P as i,Xe as j,jr as k};
