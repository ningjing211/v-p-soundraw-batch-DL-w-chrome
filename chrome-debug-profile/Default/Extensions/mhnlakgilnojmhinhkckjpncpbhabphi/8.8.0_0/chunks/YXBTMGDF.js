import{a as de}from"./VNZROBYV.js";import{i as y,q as ce}from"./W76RXALD.js";import{c as v}from"./454JMIH7.js";import{h as se}from"./DRLHFEB5.js";import{a as K}from"./P3KYY2HQ.js";import{j as P}from"./4VYUSQN4.js";import{G as le,t as ae,w as re,x as ie}from"./DPE42NE6.js";import{_ as oe}from"./U7QPOJB4.js";import{i as w,j as W,k as te,ka as z,m as ne}from"./ONVH27HX.js";import{e as Z,f as X,j as ee}from"./HFEXSQX6.js";import{a as Q}from"./4B6UFNBQ.js";import{f as J}from"./GAV6HCJA.js";var U=(e=window.location.href)=>e.includes("word-edit.officeapps.live.com/we/wordeditorframe.aspx"),$=(e=document.activeElement)=>e?.id==="WACViewPanel_EditingElement",Pe=()=>document.querySelector("#WACViewPanel_EditingElement"),G=()=>Array.from(document.querySelectorAll(["#PagesContainer .Selected:not(.OnlyImageSelected)","#PagesContainer .TableRowSelectedThemed","#PagesContainer .TableCellSelectedThemed"].join(", "))),De=()=>{let e=G();return e.length?ce(e.map(i=>i.getBoundingClientRect().toJSON())):null};var he=J(Q());var ue=J(Q());var Ve=w({key:"ContextMenuSettingsState",default:{closeBeforeRefresh:!1}}),qe=w({key:"RangyCoreState",default:{loaded:!1,rangy:null}}),Xe=w({key:"RangyState",default:{show:!1,tempSelection:null,currentSelection:null,lastCursorPosition:null}}),ye=w({key:"ContextMenuState",default:{open:!1,openAutoExecute:!1,rootRect:null,showModelSelector:!1,miniMenuPlacement:null}}),ze=W({key:"ContextMenuOpenSelector",get(e){return e.get(ye).open}}),Ke=w({key:"ContextMenuConversationState",default:""}),Ue=w({key:"FloatingDropdownMenuLastFocusRangeState",default:{range:null,selectionText:null}}),$e=w({key:"ContextWindowDraftContextMenuState",default:{selectedDraftContextMenuId:null,lastOutput:""}}),Me=w({key:"FloatingDropdownMenuSelectedItemState",default:{hoverContextMenuIdMap:{},selectedContextMenuId:null,lastHoverContextMenuId:null}}),Ge=W({key:"FloatingDropdownMenuItemsSelector",get:({get:e})=>{let i=e(Me).hoverContextMenuIdMap;return Object.values(i).filter(o=>o)}}),Ye=w({key:"GlobalDiscardStackState",default:{stack:[],haveManualEdited:!1}});var je=te({key:"FloatingImageMiniMenuState",default:{show:!1,position:{top:"0px",left:"0px"}}}),Je=(0,ue.createContext)({floatingImageMiniMenuKey:void 0}),Qe={commonFirstEnterImage:void 0,onboardingTooltipShowing:!1},Y={},Ce=()=>({disable:!1,lastHoverImage:void 0,currentHoverImage:null,currentHoverImageSrc:"",mouseInImage:!1,mouseInMenu:!1,visibility:void 0}),Ze=e=>(Y[e]||(Y[e]=Ce()),Y[e]),ge=W({key:"ShortcutHintEnableSelector",get(e){return e.get(oe).userSettings?.shortcutHintEnable}});var we=()=>{let e=v();return!!(e&&e==="mail.google.com")},O=class e{static{this.rangeMap=new Map}static setRange(i,o){o&&e.rangeMap.set(i,o)}static getRange(i){return e.rangeMap.get(i)}static removeAllRange(){e.rangeMap.clear()}},me=(e,i)=>{O.setRange(e,i)},fe=e=>O.getRange(e)||null,Ie=()=>{O.removeAllRange()},Ee=async()=>(await navigator.permissions.query({name:"clipboard-write"})).state==="granted",Te=e=>{let i=0,o=e.ownerDocument||e.document,a=o.defaultView||o.parentWindow,r;if(typeof a.getSelection<"u"&&(r=a.getSelection(),r.rangeCount>0)){let n=a.getSelection().getRangeAt(0),c=n.cloneRange();c.selectNodeContents(e),c.setEnd(n.endContainer,n.endOffset),i=c.toString().length}return i},ve=e=>{let i=0,o=0,a,r,n,c,d,t=e.ownerDocument||e.document;return typeof e.selectionStart=="number"&&typeof e.selectionEnd=="number"?(i=e.selectionStart,o=e.selectionEnd):(r=t.selection.createRange(),r&&r.parentElement()==e&&(c=e.value.length,a=e.value.replace(/\r\n/g,`
`),n=e.createTextRange(),n.moveToBookmark(r.getBookmark()),d=e.createTextRange(),d.collapse(!1),n.compareEndPoints("StartToEnd",d)>-1?i=o=c:(i=-n.moveStart("character",-c),i+=a.slice(0,i).split(`
`).length-1,n.compareEndPoints("EndToEnd",d)>-1?o=c:(o=-n.moveEnd("character",-c),o+=a.slice(0,o).split(`
`).length-1)))),{start:i,end:o}},xe=e=>{let i=e||document;if(i){if(i.getSelection)return String(i.getSelection())?.replace(/\u200B/g,"");if(i.selection)return i.selection.createRange().text?.replace(/\u200B/g,"");if(window.getSelection)return String(window.getSelection())?.replace(/\u200B/g,"")}return""},Ae=e=>{try{if(e){let i=e.ownerDocument||e.document,o=i.defaultView||i.parentWindow,a,r=`usechatgpt-start-marker-${z()}`,n=`usechatgpt-end-marker-${z()}`,c="";if(typeof i.getSelection<"u"&&(a=i.getSelection()||o.getSelection(),a.rangeCount>0)){Se();let d=o.getSelection().getRangeAt(0).cloneRange();if(e.tagName==="INPUT"||e.tagName==="TEXTAREA"){let t=e,{start:s,end:l}=ve(t);e.setAttribute("data-usechatgpt-start-offset",s.toString()),e.setAttribute("data-usechatgpt-end-offset",l.toString()),e.setAttribute("data-usechatgpt-marker","usechatgpt-marker"),e.setAttribute("data-usechatgpt-marker-start-id",r),e.setAttribute("data-usechatgpt-marker-end-id",n);let u=t.value.substring(s,l).trim().replace(/\u200B/g,""),g=(u||t.value.substring(0,s).trim()||"").replace(/\u200B/g,"");return{startMarkerId:r,endMarkerId:n,selectionText:g,editableElementSelectionText:u,pageContentRoot:null,selection:a,range:a.getRangeAt(0)}}else{let{selectionText:t,partOfStartToCaretText:s,pageContentRoot:l,selection:u,range:g}=Ne(e),m=(t||s||"").replace(/\u200B/g,"");if(document.activeElement?.tagName!=="IFRAME"&&d.startContainer?.tagName==="BODY"&&d.startContainer?.isSameNode(d.endContainer)&&(m=""),!we())return me(r,d.cloneRange()),me(n,d.cloneRange()),{startMarkerId:r,endMarkerId:n,selectionText:m,editableElementSelectionText:t,pageContentRoot:l,selection:u,range:g};let f=d.cloneRange();f.collapse(!0);let p=i.createElement("span");p.id=r,p.style.lineHeight="0",p.style.display="none",p.textContent=c,p.setAttribute("data-usechatgpt-marker","usechatgpt-marker"),p.setAttribute("contenteditable","false"),p.setAttribute("data-usechatgpt-marker-start-id",r),f.insertNode(p),f=d.cloneRange(),f.collapse(!1);let E=i.createElement("span");return E.id=n,E.style.lineHeight="0",E.style.display="none",E.textContent=c,E.setAttribute("data-usechatgpt-marker","usechatgpt-marker"),E.setAttribute("contenteditable","false"),E.setAttribute("data-usechatgpt-marker-end-id",n),f.insertNode(E),{startMarkerId:r,endMarkerId:n,selectionText:m,editableElementSelectionText:t,pageContentRoot:l,selection:u,range:g}}}}}catch{}return{startMarkerId:"",endMarkerId:"",selectionText:"",editableElementSelectionText:"",pageContentRoot:null,selection:null,range:null}},Ne=e=>{let i=v(),o="",a="",r=null,n=null,c=null,d=null;try{if(e){let t=e.ownerDocument||e.document,s=t.defaultView||t.parentWindow;if(typeof s.getSelection<"u"&&(c=s.getSelection(),c&&c.rangeCount>0)){switch(d=c.getRangeAt(0).cloneRange(),o=(c.toString()||d.toString()).trim().replace(/\u200B/g,""),i){case"writer.zoho.com":if(r=document.querySelector("#editorpane"),r){let l=r.querySelectorAll(".overlay"),u=[];if(l.length>0){l.forEach(m=>{let f=m.parentElement?.querySelector(".zw-line-content");f&&(u.find(p=>p===f)||u.push(f))});let g=u.map(m=>m.innerText).join("").trim().replace(/\u200B/g,"");g&&(o=g)}o||(n=r.querySelector("div.cursor[id]"))}break;case"word-edit.officeapps.live.com":if(r=t.querySelector("#PagesContainer"),r){n=t.querySelector(".HiddenParagraph");let l=r.querySelector(".Selected");l&&(d=t.createRange(),d.selectNodeContents(l))}break;case"notion.so":r=t.querySelector(".notion-page-content")||t.querySelector('[data-content-editable-root="true"]');break;case"larksuite.com":r=t.querySelector(".page-block-children")||t.querySelector(".page-block")||t.querySelector(".root-block");break;default:break}if(!o){let l=d.cloneRange(),u=r||e;l.selectNodeContents(u),n?l.setEndBefore(n):l.setEnd(d.endContainer,d.endOffset),a=l.toString().trim().replace(/\u200B/g,""),i==="writer.zoho.com"?a=a.replaceAll("Header OptionsExitDouble click to edit header","").replaceAll("Footer OptionsExitDouble click to edit footer","").trim():i==="word-edit.officeapps.live.com"&&(a=l.toString(),l.selectNodeContents(e),l.setEnd(d.endContainer,d.endOffset),a+=l.toString(),a=a.trim().replace(/\u200B/g,""))}}}}catch{}return{selectionText:o,partOfStartToCaretText:a,pageContentRoot:r,hostSpecialCursor:n,selection:c,range:d}},Le=(e,i,o)=>{let a=e.ownerDocument||document;if(e.focus(),e.setSelectionRange(i,o),e.tagName==="TEXTAREA"){let r=e,n=getComputedStyle(r),c=r.value.match(/\w/)?.[0]||"M",d=n.fontSize,t=n.fontFamily,s=a.createElement("span");s.style.fontSize=d,s.style.fontFamily=t,s.style.position="absolute",s.style.top="-9999px",s.style.left="-9999px",s.innerText=c,a.body.appendChild(s);let l=s.offsetWidth;s.remove();let u=Math.floor(r.getBoundingClientRect().width/l)||30,g=r.value.substring(0,o),m=se(g.split(/\n/).map(p=>{let E=Math.ceil(p.length/u);return Math.max(E,1)})),f=r.clientHeight/r.rows;r.scrollTop=f*m}else if(e.tagName==="INPUT"){let r=e;r.scrollLeft=r.scrollWidth}},mt=async(e,i,o,a)=>{let r=null,n=document.querySelector(`[data-usechatgpt-marker-start-id="${e}"`),c=document.querySelector(`[data-usechatgpt-marker-end-id="${i}"`),d=null;if(!(!n&&!c&&(d=fe(e)||fe(i),!d))){if(n&&(n.tagName==="INPUT"||n.tagName==="TEXTAREA")){let t=n;r=t;let s=t?.ownerDocument||document,l=Number(t.getAttribute("data-usechatgpt-start-offset")),u=Number(t.getAttribute("data-usechatgpt-end-offset"));if(K(l)&&K(u)){t.tagName==="TEXTAREA"?o=o.replace(/\n+/,`
`):(o=o.replace(/\n+/," "),o=o.replace(/\s+/," "));let g="",m="",f="";a==="REPLACE_SELECTION"?(m=t.value.substring(0,l),f=t.value.substring(u,t.value.length)):a==="INSERT_BELOW"?(m=t.value.substring(0,u),f=t.value.substring(u,t.value.length),!m.endsWith(`
`)&&t.tagName==="TEXTAREA"?o=`
`+o:!m.endsWith(" ")&&t.tagName==="INPUT"&&(o=" "+o)):a==="INSERT_ABOVE"?(m=t.value.substring(0,l),f=t.value.substring(l,t.value.length),!f.startsWith(`
`)&&t.tagName==="TEXTAREA"?o=o+`
`:!f.startsWith(" ")&&t.tagName==="INPUT"&&(o=o+" ")):a==="INSERT"&&(m=t.value.substring(0,u),f=t.value.substring(u,t.value.length)),g=m+o+f;try{await Ee()?(await navigator.clipboard.writeText(g),t.focus(),t.select(),s.execCommand("paste",!1,"")):(t.focus(),t.select(),s.execCommand("insertText",!1,g))}catch{t.focus(),t.select(),s.execCommand("insertText",!1,g)}Le(t,m.length,m.length+o.length)}}else if(d){a==="INSERT_BELOW"?o=(`
`+o).replace(/^\n+/,`
`):a==="INSERT_ABOVE"&&(o=(o+`
`).replace(/\n+$/,`
`));try{let t=d.cloneRange();a==="REPLACE_SELECTION"||(a==="INSERT"||a==="INSERT_BELOW"?(t.setStart(d.endContainer,d.endOffset),t.setEnd(d.endContainer,d.endOffset)):a==="INSERT_ABOVE"&&(t.setStart(d.startContainer,d.startOffset),t.setEnd(d.startContainer,d.startOffset))),await pe(t,o,a)}catch{}}else if(n&&c){let{editableElement:t}=H(n);if(!t)return;r=t;let s=t.ownerDocument||document,l=s.createRange();if(l.selectNode(t),l.setStartAfter(n),l.setEndBefore(c),a==="INSERT_BELOW"?(o=(`
`+o).replace(/^\n+/,`
`),l.setStart(l.endContainer,l.endOffset)):a==="INSERT_ABOVE"?(o=(o+`
`).replace(/\n+$/,`
`),l.setEnd(l.startContainer,l.startOffset)):a==="REPLACE_SELECTION"||a==="INSERT"&&(o=o.replace(/^\n+/,""),l.setStart(l.endContainer,l.endOffset)),n.parentElement&&c.parentElement&&n.parentElement.isSameNode(c.parentElement)){let p=l.startOffset,E=l.endOffset,T=n.parentElement;n.remove(),c.remove();let I=!0;for(let S=0;S<T.childNodes.length;S++)if(T.childNodes[S].nodeType!==Node.TEXT_NODE){I=!1;break}if(I){let S=l.toString(),A=s.createTextNode(T.innerText);if(T.innerHTML="",T.appendChild(A),S.length>0){let h=Math.max(T.innerText.indexOf(S),0),x=h+S.length;l.setStart(T.childNodes[0],h),l.setEnd(T.childNodes[0],x)}else if(p===E){let h=T.childNodes[0];if(!h)return;E===0?(l.setStart(h,0),l.setEnd(h,0)):(l.setStart(h,h.nodeValue?.length||0),l.setEnd(h,h.nodeValue?.length||0))}}}let u=()=>{s.getSelection()?.removeAllRanges(),a==="INSERT_BELOW"||a==="INSERT"?(l.setStart(l.endContainer,l.endOffset),l.setEnd(l.endContainer,l.endOffset)):a==="INSERT_ABOVE"&&(l.setStart(l.startContainer,l.startOffset),l.setEnd(l.startContainer,l.startOffset)),s.getSelection()?.addRange(l)},g=()=>{t&&t.focus()},m=(p,E)=>{let T=l.cloneRange();a==="REPLACE_SELECTION"&&T.deleteContents(),s.getSelection()?.removeAllRanges(),s.getSelection()?.addRange(T);let{separator:I=`

`,tagName:S="div",className:A="",cssText:h="",onSeparator:x}=E||{};p.split(I).reverse().forEach((b,B,L)=>{let M=s.createElement(S);if(A&&(M.className=A),h&&(M.style.cssText=h),M.innerText=b,T.insertNode(M),x&&L[B+1]){let C=x(b);T.insertNode(C)}}),s.getSelection()?.removeAllRanges(),s.getSelection()?.addRange(T)};switch(v()){case"mail.google.com":g(),u(),m(o,{cssText:"white-space: pre-wrap;",onSeparator:()=>{let p=s.createElement("div"),E=s.createElement("br");return p.appendChild(E),p}});break;default:g(),u(),await pe(l,o,a)}if(r){let p=new KeyboardEvent("keyup",{bubbles:!0,cancelable:!0});n.dispatchEvent(p)}}Se(),Ie()}},Se=()=>{typeof document>"u"||document.querySelectorAll("[data-usechatgpt-marker]").forEach(e=>{if(e.tagName==="SPAN"||e?.id.includes("usechatgpt-marker")){e.remove();return}e.removeAttribute("data-usechatgpt-marker"),e.removeAttribute("data-usechatgpt-start-offset"),e.removeAttribute("data-usechatgpt-end-offset"),e.removeAttribute("data-usechatgpt-marker-start-id"),e.removeAttribute("data-usechatgpt-marker-end-id")})},ft=()=>{typeof document>"u"||document.getSelection()?.removeAllRanges()},H=(e,i=10)=>{if(!e)return{isEditableElement:!1,editableElement:null};let o=e,a=null,r=i;for(;o&&r>0;){if(D(o)){a=o;break}o=o.parentElement,r--}return a?{isEditableElement:!0,editableElement:a}:{isEditableElement:!1,editableElement:null}},pt=(e,i)=>{let o=e,a=xe(),r="",{isEditableElement:n,editableElement:c}=H(o),d="",t="",s=0;n&&c&&(s=Te(c));let l=y(o.getBoundingClientRect()),u=null;try{let m=window.getSelection()?.getRangeAt(0)?.getBoundingClientRect();m&&(u=y(m),n&&m.width+m.height===0&&(u=y(e.getBoundingClientRect())))}catch{}if(!u){let m={left:0,right:window.innerWidth,top:0,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight,x:0,y:0};u={x:m.width/2,y:m.height/2,left:m.width/2,right:m.width/2,top:m.height/2,bottom:m.height/2,width:0,height:0}}return{isEmbedPage:!1,virtual:!1,tagName:o.tagName,eventType:"mouseup",target:o,isEditableElement:n,selectionText:a,selectionHTML:a,selectionRect:u,caretOffset:s,startMarkerId:d,endMarkerId:t,editableElementSelectionText:r,editableElementSelectionHTML:r,targetRect:l,...i}},ht=(e=!0)=>{let i,o;if(document.selection)return i=document.selection.createRange(),i.collapse(e),i.parentElement();{let a=window.getSelection();if(a?.getRangeAt?a?.rangeCount>0&&(i=a.getRangeAt(0)):(i=document.createRange(),i.setStart(a?.anchorNode,a?.anchorOffset),i.setEnd(a?.focusNode,a?.focusOffset),i.collapsed!==a?.isCollapsed&&(i.setStart(a?.focusNode,a?.focusOffset),i.setEnd(a?.anchorNode,a?.anchorOffset))),i){o=i[e?"startContainer":"endContainer"];let r=o.nodeType===3?o.parentNode:o;if(r.tagName==="BODY"||r.tagName==="HTML"||r.tagName==="IFRAME")return;if(D(r))return r;if(r.querySelector){let d=r.querySelector('[contenteditable="true"]');if(d&&D(d))return d;let t=r.querySelector("input,textarea");if(t&&D(t))return t}let{editableElement:n,isEditableElement:c}=H(r);return c?n:void 0}}};var D=e=>{if(!e?.tagName)return!1;if(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.getAttribute?.("contenteditable")==="true"){let i=e.getAttribute("type"),o=e.getAttribute("readonly"),a=e.getAttribute("aria-readonly"),r=e.getAttribute("disabled"),n=e.getAttribute("aria-disabled");return!(i&&["password","file","checkbox","radio","submit","reset","button","image","hidden"].includes(i)||o==="true"||r==="true"||a==="true"||n==="true"||o===""||r===""||e.id===Z||e.id===ee)}return!1},pe=async(e,i,o)=>{let a=e.cloneRange(),r=e.cloneRange(),n=(e.startContainer||e.endContainer)?.ownerDocument||document;if(!(!n||n.getElementById(X)))try{let c=n.getSelection(),d=v(),t=i,s=n.createElement("div");if(s.id=X,s.setAttribute("contenteditable","true"),s.style.cssText="width: 1px;height: 1px;position: fixed;top: 0px;left:0px;overflow: hidden; z-index: -1;",n.body.appendChild(s),s.addEventListener("paste",g=>{g.stopPropagation()},!0),s.addEventListener("copy",g=>{g.stopPropagation(),t=n?.getSelection()?.toString()||t},!0),await Ee()){s.focus(),await navigator.clipboard.writeText(i),s.focus();let g=n.createRange();g.selectNodeContents(s),c?.removeAllRanges(),c?.addRange(g),n.execCommand("paste",!1,"")}else{s.focus();let g=n.createRange();g.selectNodeContents(s),c?.removeAllRanges(),c?.addRange(g),n.execCommand("insertText",!1,i)}try{s.focus();let g=n.createRange();g.selectNodeContents(s),c?.removeAllRanges(),c?.addRange(g),n.execCommand("copy",!1,"")}catch{let m=s.innerText.trim();try{let f=new le;f.addRule("pre",{filter:"pre",replacement:function(E,T){return"```\n"+T.textContent+"\n```"}});let p=f.turndown(s);await navigator.clipboard.writeText(p||m)}catch{await navigator.clipboard.writeText(m)}}finally{s.remove()}let l=n.getSelection(),{editableElement:u}=H(a.startContainer||a.endContainer);if(l&&a){if(["discord.com"].includes(v())&&await navigator.clipboard.writeText(t),U()&&$(u)&&G().length?o==="INSERT"||o==="INSERT_BELOW"?u?.dispatchEvent(new KeyboardEvent("keydown",{code:"ArrowRight",key:"ArrowRight",keyCode:39,bubbles:!0,repeat:!1})):o==="INSERT_ABOVE"?u?.dispatchEvent(new KeyboardEvent("keydown",{code:"ArrowLeft",key:"ArrowLeft",keyCode:37,bubbles:!0,repeat:!1})):(l.removeAllRanges(),l.addRange(a),c?.removeAllRanges(),c?.addRange(r)):(l.removeAllRanges(),l.addRange(a),c?.removeAllRanges(),c?.addRange(r)),d==="evernote.com"||(d==="discord.com"?await P(100):await P(0)),["evernote.com","web.whatsapp.com","outlook.live.com","outlook.office.com","docs.google.com","canva.com","notion.so"].includes(d)||window.location.href.startsWith("https://www.youtube.com/shorts"))c?.toString().trim()?n.execCommand("Delete",!1,""):d==="evernote.com"&&n.execCommand("insertText",!1," "),d==="evernote.com"||(d==="notion.so"?(await P(300),n.execCommand("paste",!1,"")):n.execCommand("insertText",!1,t));else if(U()&&$(u)){let g=new DataTransfer;g.setData("text/plain",t),u?.dispatchEvent(new ClipboardEvent("paste",{clipboardData:g,bubbles:!0,cancelable:!0}))}else n.execCommand("paste",!1,"");r.collapse(!1),c?.collapseToEnd()}}catch{}},ke=e=>{try{let i=e.target,a=(i.ownerDocument||i.document).getSelection();if(a&&a.rangeCount>0){let r=a.getRangeAt(0),n=r.startContainer||r.endContainer;if(n&&n.nodeType===3)n=n.parentNode;else if(n.childNodes.length>0&&r.startOffset===r.endOffset&&r.startOffset>=0){let s=r.startContainer,l=r.startOffset,u=s.childNodes[l];u.isSameNode(document.getElementById("max-ai-rich-text-editor-placeholder"))?u.nextSibling&&(n=u.nextSibling):u&&(n=u)}let c=n?.tagName?.toLowerCase(),d=v();d="";let t="1";switch(d){case"notion.so":break;case"larksuite.com":if(c==="span"&&n.getAttribute("data-string")==="true"){if(n?.parentElement?.parentElement?.getAttribute("data-placeholder"))break;t=n.innerText}break;case"mail.google.com":break;case"outlook.live.com":case"outlook.office.com":case"outlook.office365.com":{let s=v(),l=!1,u=n;if(location.href.startsWith(`https://${s}/mail/`)){c==="br"&&(l=!0,n?.parentElement?.parentElement&&(u=n.parentElement.parentElement)),(c==="span"||c==="div")&&n.childNodes.length===1&&n.childNodes[0].nodeName.toLowerCase()==="br"&&(l=!0,u=n.parentElement);let g=u.getAttribute("role"),m=u.getAttribute("contenteditable");g==="textbox"&&m==="true"&&(l?t="":t=n.innerText)}}break;case"writer.zoho.com":{let s=document.querySelector("#editorpane")?.querySelector(".cursor");if(!s)break;n=s.parentElement,s?.previousElementSibling&&(n=s.previousElementSibling,t=n.innerText)}break;default:break}return{richTextEditorLineText:t.trim().replace(/\u200B/g,""),richTextEditorLineTextElement:n}}return{richTextEditorLineText:"1",richTextEditorLineTextElement:null}}catch{return{richTextEditorLineText:"1",richTextEditorLineTextElement:null}}},Oe=(e,i)=>{if(!i){j();return}let o=window.getComputedStyle(e),a=o.getPropertyValue("font-size"),r=o.getPropertyValue("color"),n=o.getPropertyValue("font-family"),c=o.getPropertyValue("font-weight"),d=o.getPropertyValue("font-style");j();let t=document.createElement("span");t.id="max-ai-rich-text-editor-placeholder",t.style.fontSize=a,t.style.color=r,t.style.fontFamily=n,t.style.fontWeight=c,t.style.fontStyle=d,t.style.zIndex="999999999",t.style.pointerEvents="none",t.style.opacity="0.5",t.style.position="relative",t.style.display="inline",t.style.whiteSpace="nowrap",t.setAttribute("data-placeholder",i);let s=v();if(s==="larksuite.com")t.style.lineHeight="18px";else if(s==="writer.zoho.com"){let l=e?.parentElement?.parentElement?.getAttribute("data-textformat");try{let u=JSON.parse(l||"{}").size||12;t.style.fontSize=`${Number(u)}pt`}catch{t.style.fontSize="12pt"}e.insertBefore(t,e.firstChild);return}e.tagName.toLowerCase()==="br"?e.parentElement?.insertBefore(t,e):e.appendChild(t)},j=()=>{document.getElementById("max-ai-rich-text-editor-placeholder")?.remove()},Et=()=>{let{chatBoxShortCutKey:e,floatingMenuShortCutKey:i}=de(),o=ne(ge);(0,he.useEffect)(()=>{let a=t=>{let{richTextEditorLineText:s,richTextEditorLineTextElement:l}=ke(t);if(!s&&l){let u=i&&o?`Press '${i}' for AI`:"";Oe(l,u)}else j()},r=t=>{a(t)},n=t=>{},c=t=>{a(t)},d=t=>{a(t)};return document.addEventListener("focus",d,!0),document.addEventListener("keyup",r,!0),document.addEventListener("keydown",n,!0),document.addEventListener("mouseup",c,!0),()=>{document.removeEventListener("focus",d,!0),document.removeEventListener("keyup",r,!0),document.removeEventListener("keydown",n,!0),document.removeEventListener("mouseup",c,!0)}},[e,i,o])};var Tt=e=>{let i=document.querySelectorAll("iframe"),o=[],a=[];return i.forEach(r=>{if(r.getAttribute("sandbox")){if(r.getAttribute("sandbox")?.includes("allow-scripts"))return;r.contentDocument&&r.contentWindow&&o.push(r)}}),o.forEach(r=>{let n=r?.contentDocument,c=r?.contentWindow;if(!n||!c)return;let d=[],t=null,s=u=>{try{let g=t||u.target,m=xe(n),f="",{isEditableElement:p,editableElement:E}=H(g),T="",I="",S=0;if(p&&E){S=Te(E);let C=Ae(E);T=C.startMarkerId,I=C.endMarkerId,m=C.selectionText,f=C.editableElementSelectionText}t=null;let A=y(n.body.getBoundingClientRect()),h=y(g.getBoundingClientRect()),x=c.getSelection()?.getRangeAt(0)?.getBoundingClientRect(),b=null;if(g.tagName==="INPUT"||g.tagName==="TEXTAREA"){let C=Math.max(h.left,0),k=Math.max(h.top,0),N=(n.documentElement.clientWidth||n.body.clientWidth||n.body.offsetWidth)-C,R=n.documentElement.clientHeight||n.body.clientHeight||n.body.offsetHeight,_=Math.max(h.left,0),F=Math.max(h.left,0),V=Math.min(k,R),q=Math.min(k,R),be=Math.min(h.left>0?h.width:h.width+h.left,N),Re=Math.min(h.top>0?h.height:h.height+h.top,R);b={left:_,x:F,top:V,y:q,width:be,height:Re,right:Math.max(Math.min(h.width,N),N),bottom:Math.min(h.bottom,R)},b.height=Math.min(R-b.top,b.height)}else if(x){let C=Math.max(x.left,0),k=Math.max(x.top,0),N=(n.documentElement.clientWidth||n.body.clientWidth||n.body.offsetWidth)-C,R=n.documentElement.clientHeight||n.body.clientHeight||n.body.offsetHeight,_=Math.max(x.left,0),F=Math.max(x.left,0),V=Math.min(k,R),q=Math.min(k,R);b={left:_,x:F,top:V,y:q,width:Math.min(x.width,N),height:Math.min(x.height,R),right:Math.max(Math.min(x.right,N),N),bottom:Math.min(x.bottom,R)},b.height=Math.min(R-b.top,b.height)}let B=[d[0]-window.screenLeft,d[1]-window.screenTop],L=y(r.getBoundingClientRect()),M={virtual:!0,iframeId:"",tagName:g.tagName,id:g.id,className:g.className,windowRect:y(A),targetRect:y(h),selectionRect:x?y(x):void 0,iframeSelectionRect:b?y(b):void 0,iframePosition:B,selectionText:m||"",selectionHTML:m||"",editableElementSelectionText:f,editableElementSelectionHTML:f,eventType:u.type==="mouseup"?"mouseup":"keyup",isEmbedPage:!1,isEditableElement:p,caretOffset:S,startMarkerId:T,endMarkerId:I};M.selectionRect.top+=L.top,M.selectionRect.left+=L.left,M.selectionRect.right+=L.left,M.selectionRect.bottom+=L.top,e(M)}catch{}},l=u=>{let g=u.target;(g.tagName==="INPUT"||g.tagName==="TEXTAREA")&&(t=g),d=[u.screenX,u.screenY]};n.addEventListener("mousedown",l),n.addEventListener("mouseup",s),n.addEventListener("keyup",s),a.push(()=>{n.removeEventListener("mousedown",l),n.removeEventListener("mouseup",s),n.removeEventListener("keyup",s)})}),()=>{a.forEach(r=>{r()})}};var He=(e,i=2e3,o=document.body)=>{let a=document.activeElement,r=e.startContainer,n=e.startOffset,c=e.endContainer,d=e.endOffset,t=e.toString().trim().replace(/\u200B/g,"");if(t.length>=i)return{beforeText:"",selectionText:"",afterText:"",relatedContent:""};if(a&&ae(a)){let m=a.value,f=a.selectionStart||0,p=a.selectionEnd||0,E=Math.ceil((i-t.length)/2),T=m.slice(Math.max(0,f-E),f),I=i-E,S=m.slice(p,Math.min(m.length,p+I));return{beforeText:T,selectionText:t,afterText:S,relatedContent:`${T}${t}${S}`.trim()}}let s=Math.ceil((i-t.length)/2),l=re(r,n,s,o),u=i-s,g=ie(c,d,u,o);return{beforeText:l,selectionText:t,afterText:g,relatedContent:`${l}${t}${g}`.trim()}},bt=(e,i=2e3,o=document.body)=>!e||e.rangeCount===0?{beforeText:"",selectionText:"",afterText:"",relatedContent:""}:He(e.getRangeAt(0),i,o);var Ct=(e,i,o)=>new Promise((a,r)=>{let n=setTimeout(()=>{a(o)},i);e.then(c=>{clearTimeout(n),a(c)}).catch(c=>{clearTimeout(n),r(c)})}),wt=e=>new Promise(i=>setTimeout(i,e));export{Ve as a,qe as b,Xe as c,ye as d,ze as e,Ke as f,Ue as g,$e as h,Me as i,Ge as j,Ye as k,je as l,Je as m,Qe as n,Ze as o,ge as p,U as q,$ as r,Pe as s,G as t,De as u,Te as v,xe as w,Ae as x,mt as y,Se as z,ft as A,H as B,pt as C,ht as D,Et as E,Tt as F,He as G,bt as H,Ct as I,wt as J};
