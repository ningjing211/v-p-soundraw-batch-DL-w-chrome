import{k as p,o as y}from"./RHEDGG6N.js";import{Fa as o,v}from"./ONVH27HX.js";var u=["feedback","funnel_survey__survey_cancel_completed"];var m=i=>Object.keys(i).reduce((e,r)=>(e[r.toLowerCase()]=i[r],e),{});var c=class{constructor(){this.cacheService=new y({saveKey:"MAXAI_CLIENT__FEATURES__MARKETING__SURVEY_STATUS",cacheTime:y.DAILY*365})}async fetchSurveyStatus(e){let{data:r}=await o.fetch("/user/find_user_survey_key",{method:"POST",body:JSON.stringify({survey_keys:e?[e]:u})});return r?.data?.survey_key_objs?r.data.survey_key_objs.map(t=>t.key):[]}async getSurveyStatus(e,r=!1){if(r){let t=await this.fetchSurveyStatus(e);if(t){let a={...(await this.cacheService.get()).data};return[...u].forEach(s=>{a[s]=t.includes(s)}),this.cacheService.sync(a),a}else return{}}else{let t=await this.cacheService.get();return t.data&&!t.expired?t.data:await this.getSurveyStatus(e,!0)}}async submitSurvey(e,r,t,n){let a=m(r),S=await o.fetch("/user/save_user_survey_key",{method:"POST",body:JSON.stringify({survey_key:e,survey_content:a})});if(t){let s=await p(),d={...n,client_user_id:s,data:{...n?.data,...a}};await o.fetch("/app/send_mixpanel_log",{method:"POST",body:JSON.stringify({info:v(d)})})}return S.data?.status==="OK"}async clearSurveyStatus(){await this.cacheService.clear()}};var _=new c;export{_ as a};
