import{g as z}from"./3MKI6XLK.js";import{l as B,q as w}from"./Z2GQCHLU.js";import{q as _}from"./DPE42NE6.js";import{I as v,i as p,k as P,n as x,q as h}from"./ONVH27HX.js";import{a as f}from"./4B6UFNBQ.js";import{m as O}from"./WUP5AHVL.js";import{f as c}from"./GAV6HCJA.js";var a=c(f()),re=(e,o)=>{let t=z(o||{}),[s,n]=(0,a.useState)(!0),[r,i]=(0,a.useState)(0),[u,m]=(0,a.useState)(),[A,T]=(0,a.useState)(e instanceof File?e:null),[S,k]=(0,a.useState)(null),[X,R]=(0,a.useState)(""),U=o?.fileName||S?.name||A?.name||"",H=o?.fileSize||S?.size||A?.size||0,j=o?.fileType||S?.type||A?.type||"";return(0,a.useEffect)(()=>{let d=!1,E=null,G=async()=>{let l=e instanceof File?e:null,M="",N=typeof e=="string"?e:"";if(N){if(l=await B.loadFile(N,{onProgress(D){d||(i(D.progress*.8),k(D.fileInfo))}}),d)return null;T(l)}if(l)if(t.current.loadFileText){if(M=await v(l,D=>{d||i(()=>80+D.progress*.2)}),d)return null;R(M)}else i(100);return{file:l,fileText:M}};return E=t.current.onLoadStart?.(),G().then(l=>{d||l?.file&&(n(!1),T(l.file),R(l.fileText),E=t.current.onLoadSuccess?.({file:l.file,fileText:l.fileText}))}).catch(l=>{d||(n(!1),m(l),E=t.current.onLoadError?.(l))}),()=>{d=!0,n(!0),i(0),m(void 0),T(null),k(null),E&&E(),t.current.onLoadReset?.()}},[e]),{loading:s,progress:r,error:u,file:A,fileText:X,fileName:U,fileSize:H,fileType:j}};var g=c(f()),se=()=>{let[e,o]=(0,g.useState)(!1),[t,s]=(0,g.useState)(!0),n=(0,g.useRef)();return(0,g.useEffect)(()=>{if(clearTimeout(n.current),!e&&!t)return n.current=setTimeout(()=>o(!0),3e3),()=>{clearTimeout(n.current)}},[t,e]),{isFreeze:e,resetFreeze:()=>{!t&&e&&o(!1)},disableFreeze:()=>{s(!0)},enableFreeze:()=>{s(!1)}}};var ce=p({key:"ChatPDFThumbnailState",default:{hidden:O}}),K=new Map,F=P({key:"MaxAIDocumentStateFamily",default:null,effects:e=>[({onSet:o})=>{o(t=>{t&&K.set(e,t)})}]});var q=e=>{let[o,t]=x(F(e));return{document:o,setDocument:t}},J=()=>{let e=h(({snapshot:s,set:n})=>async(r,i)=>{let u=await s.getPromise(F(r));if(u&&!i)return u;let m=i?await w.downloadDocument(r,{forceUpdate:i}):await w.downloadDocument(r);return m.success&&m.data&&n(F(r),m.data),m.data},[]),o=h(({set:s})=>async n=>{let r=await w.uploadDocument(n);return r.success&&r.data&&s(F(r.data.doc_id),r.data),r},[]),t=h(({set:s})=>async(n,r)=>{s(F(n),r)},[]);return{downloadDocument:e,uploadDocument:o,updateDocument:t}},pe=e=>{let o=q(e||""),t=J();return{...o,...t}};var C=c(f());var V=c(f());var I=c(f());var W=p({key:"ExtensionInstallAlertOpenAtom",default:!1}),Q=p({key:"ExtensionUpgradeAlertOpenAtom",default:!1}),y=()=>{let[e,o]=x(W),[t,s]=x(Q),n=(0,I.useCallback)(()=>{o(!0)},[]),r=(0,I.useCallback)(()=>{o(!1)},[]),i=(0,I.useCallback)(()=>{s(!0)},[]),u=(0,I.useCallback)(()=>{s(!1)},[]);return{installAlertOpen:e,openExtensionInstallAlert:n,closeExtensionInstallAlert:r,upgradeAlertOpen:t,openExtensionUpgradeAlert:i,closeExtensionUpgradeAlert:u}};var L=p({key:"MaxAIBrowserExtensionAtom",default:{loaded:!1,hasExtension:!1,extensionVersion:null}});var Y=(e=!1)=>{let[o,t]=x(L),{openExtensionInstallAlert:s}=y(),n=(r=!1)=>{let i=_();return i?t({loaded:!0,hasExtension:!0,extensionVersion:i}):r&&s(),!!i};return(0,V.useEffect)(()=>{e&&n()},[e]),{...o,check:n}};var b=c(f());var Z=c(f());var $=c(f());export{ce as a,q as b,J as c,pe as d,re as e,se as f,Y as g};
