import{b as C}from"../../chunks/UJVCA7OP.js";import{B as k,G as te,H as ne,q as H,r as P,s as z,t as D,u as J,v as Q,w as Z,x as $,y as ee}from"../../chunks/YXBTMGDF.js";import"../../chunks/VNZROBYV.js";import{k as O}from"../../chunks/EXH2YVMS.js";import"../../chunks/PW2PVNG6.js";import{k as N}from"../../chunks/Z2GQCHLU.js";import"../../chunks/6CLNRQN2.js";import"../../chunks/XMSUU4RH.js";import{b as oe,c as ie}from"../../chunks/BYL62TPW.js";import{I as y}from"../../chunks/W76RXALD.js";import"../../chunks/N5EAU2XY.js";import"../../chunks/454JMIH7.js";import"../../chunks/RY63BUJF.js";import"../../chunks/DRLHFEB5.js";import"../../chunks/P3KYY2HQ.js";import"../../chunks/77DTOUOQ.js";import"../../chunks/AVXABA5R.js";import"../../chunks/6OS2OCGS.js";import"../../chunks/IPQKZCT2.js";import"../../chunks/GFMUSIRW.js";import"../../chunks/HPHM72CW.js";import"../../chunks/SNEXM654.js";import{a as _}from"../../chunks/4VYUSQN4.js";import"../../chunks/27O46L5C.js";import{c as F}from"../../chunks/JVSFDP7Y.js";import"../../chunks/VOKYBSBD.js";import"../../chunks/DBAIQPWT.js";import"../../chunks/WBYFOOBE.js";import"../../chunks/V3YOWZUQ.js";import{H as j,s as pe,u as Ee}from"../../chunks/RHEDGG6N.js";import{b as Y}from"../../chunks/ENA3LJHP.js";import{n as K,o as E}from"../../chunks/DPE42NE6.js";import"../../chunks/U7QPOJB4.js";import"../../chunks/57QVGQHC.js";import{Aa as I,Ca as A,ka as q}from"../../chunks/ONVH27HX.js";import"../../chunks/UB52WFCV.js";import"../../chunks/HFEXSQX6.js";import"../../chunks/4B6UFNBQ.js";import"../../chunks/WUP5AHVL.js";import"../../chunks/PJ57C2TE.js";import{f as G}from"../../chunks/GAV6HCJA.js";var me=G(pe()),de=G(Ee());var ae=q(),re=t=>({left:t.left,right:t.right,top:t.top,bottom:t.bottom,width:t.width||t.right-t.left,height:t.height||t.bottom-t.top,x:t.x||t.left,y:t.y||t.top}),he=()=>{if(!I())return;y(async(e,i,n)=>{switch(e){case"Client_listenUpdateIframeInput":{let{startMarkerId:s,endMarkerId:m,value:h,type:w}=i;return s&&m&&await ee(s,m,h,w),{success:!0,data:{},message:""}}}});let t=null,l=[],a=!1,o=(e,i=0)=>{try{let n=t||e.target,{isEditableElement:s,editableElement:m}=k(n),h=Z(),w="",W="",B="",U=0,x=null,S=null,M=document.body,V="";if(s&&m){U=Q(m);let f=$(m);W=f.startMarkerId,B=f.endMarkerId,h=f.selectionText,w=f.editableElementSelectionText,M=m.parentElement?k(m.parentElement).editableElement:m,M=M||m,x=f.selection,S=f.range}else x=window.getSelection();!h&&a&&n.tagName==="BUTTON"&&i<10&&setTimeout(()=>{o(e,i+1)},100),t=null;let ue=re(document.body.getBoundingClientRect()),c=re(n.getBoundingClientRect()),d=window.getSelection()?.getRangeAt(0)?.getBoundingClientRect(),g=null;if(H()&&P()&&(d=J()||d),n.tagName==="INPUT"||n.tagName==="TEXTAREA"){let f=Math.max(c.left,0),T=Math.max(c.top,0),p=(document.documentElement.clientWidth||document.body.clientWidth||document.body.offsetWidth)-f,u=document.documentElement.clientHeight||document.body.clientHeight||document.body.offsetHeight,R=Math.max(c.left,0),b=Math.max(c.left,0),v=Math.min(T,u),L=Math.min(T,u),X=Math.min(c.left>0?c.width:c.width+c.left,p),ge=Math.min(c.top>0?c.height:c.height+c.top,u);g={left:R,x:b,top:v,y:L,width:X,height:ge,right:Math.max(Math.min(c.width,p),p),bottom:Math.min(c.bottom,u)},g.height=Math.min(u-g.top,g.height)}else if(d){let f=Math.max(d.left,0),T=Math.max(d.top,0),p=(document.documentElement.clientWidth||document.body.clientWidth||document.body.offsetWidth)-f,u=document.documentElement.clientHeight||document.body.clientHeight||document.body.offsetHeight,R=Math.max(d.left,0),b=Math.max(d.left,0),v=Math.min(T,u),L=Math.min(T,u);g={left:R,x:b,top:v,y:L,width:Math.min(d.width,p),height:Math.min(d.height,u),right:Math.max(Math.min(d.right,p),p),bottom:Math.min(d.bottom,u)},g.height=Math.min(u-g.top,g.height),w&&x&&(V=(S?te(S,2e3,M):ne(x,2e3,M)).relatedContent)}let fe=[l[0]-window.screenLeft,l[1]-window.screenTop];window.parent.postMessage({id:F,type:"iframeSelection",data:{virtual:!0,iframeId:ae,tagName:n.tagName,id:n.id,className:n.className,windowRect:ue,targetRect:c,selectionRect:d,iframeSelectionRect:g,iframePosition:fe,selectionText:h||"",selectionHTML:h||"",editableElementSelectionText:w,editableElementSelectionHTML:w,eventType:e instanceof MouseEvent?"mouseup":"keyup",isEmbedPage:a,isEditableElement:s,caretOffset:U,startMarkerId:W,endMarkerId:B,relatedContent:V}},"*")}catch{}},r=e=>{let i=e.target;(i.tagName==="INPUT"||i.tagName==="TEXTAREA")&&(t=i),l=[e.screenX,e.screenY]};if(document.addEventListener("mousedown",r),document.addEventListener("mouseup",o),document.addEventListener("keyup",o),window.location.href.indexOf("maxai.me/embed")>-1){let e=document.createElement("div");e.id="USE_CHAT_GPT_AI_ROOT",e.style.display="none",e.style.zIndex="-1",e.style.position="absolute",e.style.top="-10000px",e.style.left="-10000px",e.style.width="1px",e.style.height="1px",e.style.overflow="hidden",e.style.opacity="0",e.style.pointerEvents="none",document.body.appendChild(e),a=!0}if(H()){let e=document.querySelector("#WACViewPanel");z()?.addEventListener("focus",n=>{o({target:n.target})}),e?.addEventListener("mousedown",n=>{r(n);let s=document.body.getBoundingClientRect().toJSON();window.parent.postMessage({id:F,type:"iframeSelection",data:{virtual:!0,iframeId:ae,tagName:"",id:"",className:"",windowRect:s,targetRect:s,selectionRect:s,iframeSelectionRect:s,iframePosition:[0,0],selectionText:"",selectionHTML:"",editableElementSelectionText:"",editableElementSelectionHTML:"",eventType:n instanceof MouseEvent?"mouseup":"keyup",isEmbedPage:!1,isEditableElement:!0,caretOffset:0,startMarkerId:"",endMarkerId:""}},"*")}),e?.addEventListener("mouseup",n=>{let m=n.target.getBoundingClientRect();setTimeout(()=>{P()&&(D().length?o({...n,target:document.activeElement}):o({...n,target:document.elementFromPoint(m.x,m.y)}))},50)}),e?.addEventListener("scroll",Y(n=>{P()&&D().length&&o({...n,target:document.activeElement})},200))}},se=he;var we=()=>{let t="",l=document.documentElement,a=l.querySelector("#WACViewPanel_EditingElement_WrappingDiv"),o=l.querySelector("#PagesContainer .HiddenParagraph"),r=a?.style.display;return a&&(a.style.display="none"),o&&o.classList.remove("HiddenParagraph"),t=l.querySelector("#PageContentContainer")?.innerText||"",a&&(a.style.display=r),o&&o.classList.add("HiddenParagraph"),t},Ie=()=>document.documentElement?.querySelector(".mail-message-defaults")?.innerText||"",ye=()=>document.documentElement?.ownerDocument?.body?.innerText||"",Me=()=>{if(!I())return;let t=typeof window<"u"?window.location.href:"";window.addEventListener("message",async l=>{let{id:a,eventType:o,taskId:r,data:e}=l.data;if(a===K){if(o==="BROWSER_EXTENSION_FEATURES__PROXY_FETCH"){let i=await oe(...e);window.postMessage({id:E,taskId:r,result:i})}if(o==="BROWSER_EXTENSION_FEATURES__ABORT_PROXY_FETCH"){let i=await ie(...e);window.postMessage({id:E,taskId:r,result:i})}if(o==="BROWSER_EXTENSION_FEATURES__GET_SPECIAL_HOST_PAGE_CONTENT"&&window.postMessage({id:E,taskId:r,result:""}),o==="BROWSER_EXTENSION_FEATURES__PING_IFRAME_PAGE"&&window.parent.postMessage({id:E,taskId:r,result:!0},"*"),o==="BROWSER_EXTENSION_FEATURES__FIND_IFRAME_PAGE_CITATION"){let[i,n]=e,s=await O.find(n);window.parent.postMessage({id:E,taskId:r,result:s},"*")}if(o==="BROWSER_EXTENSION_FEATURES__CREATE_IFRAME_PAGE_DOCUMENT"){let[i,n]=e,s=await N.generateWebpageURLDocument(t);window.parent.postMessage({id:E,taskId:r,result:s},"*")}}}),y(async(l,a,o)=>{switch(l){case"Iframe_listenGetPageContent":{let{taskId:r}=a;if(!t)return;let e="";return t.includes("word-edit.officeapps.live.com/we/wordeditorframe.aspx")&&(e=we()),t.includes("icloud-sandbox.com/applications/mail2-message")&&(e=Ie()),t.includes("mail.com/mail/client/mailbody")&&(e=ye()),e=e.trim(),e?(await new _().postMessage({event:"Iframe_sendPageContentResult",data:{taskId:r,pageContent:e}}),{success:!0,data:"",message:""}):{success:!1,data:"",message:"no page content"}}case"Iframe_listenFindPageCitation":{let{taskId:r,citation:e}=a;if(!t)return;if(!e.source?.url||!A(e.source.url,t))return{success:!1,data:"",message:"not citation page"};let i=await O.find(e);return await new _().postMessage({event:"Iframe_sendPageCitationResult",data:{taskId:r,isMatched:i}}),{success:!0,data:"",message:""}}case"Iframe_listenCreatePageDocument":{let{taskId:r,pageUrl:e}=a;if(!t)return;if(!e||!A(e,t))return{success:!1,data:"",message:"is not page url"};let i=await N.generateWebpageURLDocument(t);return await new _().postMessage({event:"Iframe_sendPageDocumentResult",data:{taskId:r,pageDocument:i}}),{success:!0,data:"",message:""}}}})},ce=Me;var Te=()=>{window.self!==window.top&&(j.getAppSettings().then(t=>{t.userSettings?.pageTranslation?.sourceLanguage&&C.updateFromCode(t.userSettings.pageTranslation.sourceLanguage),t.userSettings?.pageTranslation?.targetLanguage&&C.updateToCode(t.userSettings.pageTranslation.targetLanguage)}),y(async(t,l)=>{switch(t){case"Client_listenPageTranslationEvent":{let{fn:a,args:o}=l;return a&&C[a]&&C[a](...o),{success:!0,data:!0,message:"ok"}}default:break}}))},le=Te;me.default.extend(de.default);var Ce=()=>window.frameElement?.classList.contains("docs-texteventtarget-iframe")?!0:["https://viewscreen.githubusercontent.com/view/pdf","https://notebooks.githubusercontent.com/view"].find(t=>window.location.href.startsWith(t)),xe=async()=>{I()&&(Ce()||(window.__MAXAI__EXTENSION__VERSION__="8.8.0",ce(),le(),se()))};xe();
